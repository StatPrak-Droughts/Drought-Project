---
title: "Data analysis"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
# Import packages
library(tidyverse)
library(lubridate)
library(timetk)
library(RcppRoll)
library(dLagM)
library(dlnm)
library(zoo)
theme_set(theme_gray())
# Mapping imports
library(sf)
library(leaflet)
library(tmap)
library(gridExtra)
tmap_options(check.and.fix = TRUE)

# Read data
hydro_summer_20203 <- readRDS(file = "./data/hydro_summer_20203.RDS")
hydro_summer_11502 <- readRDS(file = "./data/hydro_summer_11502.RDS")
hydro_summer_10304 <- readRDS(file = "./data/hydro_summer_10304.RDS")
hydro_winter_20203 <- readRDS(file = "./data/hydro_winter_20203.RDS")
hydro_winter_11502 <- readRDS(file = "./data/hydro_winter_11502.RDS")
hydro_winter_10304 <- readRDS(file = "./data/hydro_winter_10304.RDS")
hydro_total <- readRDS(file = "./data/hydro_total.RDS")
pegel_prop <- readRDS(file = "./data/pegel_prop.RDS")
# Add rescaled soilwater
hydro_summer_20203$soilwater100 <- hydro_summer_20203$soilwater * 100
hydro_summer_11502$soilwater100 <- hydro_summer_11502$soilwater * 100
hydro_summer_10304$soilwater100 <- hydro_summer_10304$soilwater * 100
hydro_winter_20203$soilwater100 <- hydro_winter_20203$soilwater * 100
hydro_winter_11502$soilwater100 <- hydro_winter_11502$soilwater * 100
hydro_winter_10304$soilwater100 <- hydro_winter_10304$soilwater * 100
```

```{r}
# separate datasets for each waterlevel, season and member
# winter
for (i in pegel_ids) {
  for (j in levels(hydro_total$member)) {
    assign(paste0("hydro_winter_", i, "_", j), hydro_winter %>% filter(name_waterlevel %in% i) %>% filter(member %in% j))
  }
}

# summer
for (i in pegel_ids) {
  for (j in levels(hydro_total$member)) {
    assign(paste0("hydro_summer_", i, "_", j), hydro_summer %>% filter(name_waterlevel %in% i) %>% filter(member %in% j))
  }
}
```

## Geo Data (Map data)
```{r}
# Read in shape file
hydro_bavaria <- read_sf("./data/Geo-Daten_Uebersicht/shapefile/EZG_OHNE_Reservoir_UTM32.shp", ) 
st_crs(hydro_bavaria) # CRS WGS 84 

# Quelle Data https://hub.arcgis.com/datasets/esri-de-content::bundesl%C3%A4nder-2021-mit-einwohnerzahl/explore?location=51.947250%2C15.358806%2C5.85&showTable=true 
admin_bavaria <- read_sf("./added_data/LAN_ew_21.shp") %>% filter(GEN %in% c("Bayern", "Bayern (Bodensee)"))
admin_bavaria <- st_as_sf(admin_bavaria, crs = 4326)
pegel_prop_sf <- st_as_sf(pegel_prop, coords = c("longitude", "latitude"), crs = 4326) # crs Code for WGS 84

pegel_prop_sf$ID <- as.factor(pegel_prop_sf$ID)

# https://geoportal.bafg.de/CSWView/od.xhtml
waterways <- read_sf("./added_data/germany-waterways-shape/waterways.shp") 

waterways_three <- waterways %>% 
filter(name %in% c("Isar",
                   "Donau", 
                   "Fränkische Saale",
                   "Main",
                   "Iller"))

# Add Pegel props
hydro_bavaria_20203 <- hydro_bavaria %>% filter(gridcode == 20203) %>% 
  left_join(pegel_prop, by = c("gridcode" = "ID"))
hydro_bavaria_11502 <- hydro_bavaria %>% filter(gridcode == 11502)%>% 
  left_join(pegel_prop, by = c("gridcode" = "ID"))
hydro_bavaria_10304 <- hydro_bavaria %>% filter(gridcode == 10304)%>% 
  left_join(pegel_prop, by = c("gridcode" = "ID"))
hydro_bavaria_three <- hydro_bavaria %>% filter(gridcode %in% c(10304, 11502, 20203))%>% 
  left_join(pegel_prop, by = c("gridcode" = "ID"))

```

## Chris: Analysis

```{r Chris: Analysis of low flow events}
# First visualizations
plot_drainage <- function(dataset, year = c(2000), member_input = "kbe") {
  dataset %>% filter(YY %in% year, member == member_input) %>%
  ggplot(mapping = aes(x = date, y = drainage, color = waterlevel)) +
    geom_line() +
    scale_y_continuous(trans='log10') +
    geom_point(data = dataset %>% filter(YY %in% year, member == member_input, lowlevel == TRUE), 
               aes(x = date, y = drainage), color = "purple") +
    labs(title = "Abflussmenge für unterschiedliche Pegel über die Zeit",
       y = "Abflussmenge",
       x = "Datum") +
  guides(color=guide_legend(title="Pegel")) +
    theme(text = element_text(size = 20),
          legend.position="bottom") +
    scale_color_brewer(palette = "Dark2")
}

plot_drainage_unmarked <- function(dataset, year = c(2000), member_input = "kbe") {
  dataset %>% filter(YY %in% year, member == member_input) %>%
  ggplot(mapping = aes(x = date, y = drainage, color = waterlevel)) +
    geom_line() +
    scale_y_continuous(trans='log10') +
    labs(title = "Abflussmenge für unterschiedliche Pegel über die Zeit",
       y = "Abflussmenge",
       x = "Datum") +
  guides(color=guide_legend(title="Pegel")) +
    theme(text = element_text(size = 20),
          legend.position="bottom") +
    scale_color_brewer(palette = "Dark2")

plot_single_drainage <- function(dataset, year = c(2000), member_input = "kbe") {
  dataset %>% filter(YY %in% year, member == member_input) %>%
  ggplot(mapping = aes(x = date, y = drainage)) +
    geom_line() +
    scale_y_continuous(trans='log10') +
    geom_line(mapping = aes(y = nm7q), color = "red") +
    geom_point(data = dataset %>% filter(YY %in% year, member == member_input, lowlevel == TRUE), 
               aes(x = date, y = drainage), color = "purple") +
    labs(title = "Abflussmenge für einen Pegel über die Zeit",
       y = "Abflussmenge",
       x = "Datum") +
    theme(text = element_text(size = 20)) +
    scale_color_brewer(palette = "Dark2")
plot_single_drainage(hydro_total %>% filter(name_waterlevel == "10304"), year = 2000:2003)
# -> Daten sind saisonal
ggsave("Plots/Chris/analysis/single_drainage_Isar-Mittenwald_2000-2003.png", width = 12, height = 9)

plot_drainage(hydro_total, year = 2000)
ggsave("Plots/Chris/analysis/drainage_total_2000_kbe.png", width = 12, height = 9)

plot_drainage_unmarked(hydro_total, year = 2000)
ggsave("Plots/Chris/analysis/drainage_total_unmarked_2000_kbe.png", width = 12, height = 9)

# Visualisierung der 10 Member für 10304, Jahr 2000
hydro_total_10304 <- hydro_total %>% filter(name_waterlevel == "10304")
ggplot(data = subset(hydro_total_10304, YY %in% 2000), mapping = aes(x = date, y = drainage, color = member)) +
  geom_line() +
  geom_point() +
  labs(title = "Abfluss des Pegels Isar/Mittenwald im Jahr 2000 getrennt \nnach Simulationsreihen",
       y = "Abflussmenge",
       x = "Datum") +
    theme(text = element_text(size = 20)) +
    scale_color_brewer(palette = "Dark2")
ggsave("Plots/Chris/analysis/all_member_drainage_Isar-Mittenwald_2000.png", width = 12, height = 9)

# Tables for futher plots
table_days_low_flow <- hydro_total %>%
  group_by(waterlevel, YY) %>%
  count(lowlevel, name = "number_low_flows") %>%
  filter(lowlevel == TRUE) %>%
  mutate(avg_number_low_flows = number_low_flows / length(unique(hydro_total$member)))

table_days_low_flow_by_hydro_year <- hydro_total %>%
  group_by(hydro_year, waterlevel, YY) %>%
  count(lowlevel, name = "number_low_flows") %>%
  filter(lowlevel == TRUE) %>%
  mutate(avg_number_low_flows = number_low_flows / length(unique(hydro_total$member)))

# table_days_low_flow_summer <- hydro_summer %>%
#   group_by(waterlevel, YY) %>%
#   count(lowlevel, name = "number_low_flows") %>%
#   filter(lowlevel == TRUE) %>%
#   mutate(avg_number_low_flows = number_low_flows / length(unique(hydro_total$member)))
# 
# table_days_low_flow_winter <- hydro_winter %>%
#   group_by(waterlevel, YY) %>%
#   count(lowlevel, name = "number_low_flows") %>%
#   filter(lowlevel == TRUE) %>%
#   mutate(avg_number_low_flows = number_low_flows / length(unique(hydro_total$member)))

# Jährliche durchschnittliche Anzahl von Niedrigwasser-Tagen für die 3 Wasserstände
ggplot(data = table_days_low_flow, mapping = aes(x = YY, y = avg_number_low_flows, color = waterlevel)) +
  geom_line() +
  geom_point() +
  labs(title = "Jährliche durchschnittliche Anzahl von Niedrigwasser-Tagen \nim Zeitverlauf (aller Member)",
       y = "Jährliche durchschnittliche Anzahl von Niedrigwasser-Tagen",
       x = "Datum") +
  guides(color=guide_legend(title="Pegel")) +
    theme(text = element_text(size = 20),
          legend.position="bottom") +
    scale_color_brewer(palette = "Dark2")
ggsave("Plots/Chris/analysis/yearly_avg_number_of_low_flow_days.png", width = 12, height = 9)

ggplot(data = table_days_low_flow_by_hydro_year, mapping = aes(x = YY, y = avg_number_low_flows, color = waterlevel)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Jährliche durchschnittliche Anzahl von Niedrigwasser-Tagen je Jahreszeit \nim Zeitverlauf (aller Member)",
       y = "Jährliche durchschnittliche Anzahl von Niedrigwasser-Tagen",
       x = "Datum") +
  facet_wrap(vars(hydro_year), labeller = as_labeller(c(`summer` = "Sommer", `winter` = "Winter"))) +
  guides(color=guide_legend(title="Pegel")) +
    theme(text = element_text(size = 20),
          legend.position="bottom") +
    scale_color_brewer(palette = "Dark2")
ggsave("Plots/Chris/analysis/yearly_avg_number_of_low_flow_days_per_season.png", width = 12, height = 9)



```

# Chris: Analysis of drivers

```{r Chris: Analysis of drivers}
# Tables for futher plots
table_yearly_max_prec_by_member <- hydro_total %>%
  group_by(waterlevel, YY, member) %>%
  summarise(max_precip = max(precip))

table_yearly_avg_max_prec <- table_yearly_max_prec_by_member %>% 
  group_by(waterlevel, YY) %>%
  summarise(avg_max_precip = mean(max_precip)) 

table_yearly_avg_max_airtmp <- hydro_total %>%
  group_by(waterlevel, YY, member) %>%
  summarise(max_airtmp = max(airtmp)) %>% 
  group_by(waterlevel, YY) %>%
  summarise(avg_max_airtemp = mean(max_airtmp)) 

table_yearly_avg_max_snowstorage <- hydro_total %>%
  group_by(waterlevel, YY, member) %>%
  summarise(max_snowstorage = max(snowstorage)) %>% 
  group_by(waterlevel, YY) %>%
  summarise(avg_max_snowstorage = mean(max_snowstorage)) 

table_yearly_avg_max_soilwater <- hydro_total %>%
  group_by(waterlevel, YY, member) %>%
  summarise(max_soilwater = max(soilwater)) %>% 
  group_by(waterlevel, YY) %>%
  summarise(avg_max_soilwater = mean(max_soilwater)) 

# Plots
ggplot(data = table_yearly_avg_max_prec, mapping = aes(x = YY, y = avg_max_precip, color = waterlevel)) +
  geom_line() +
  geom_point() +
  labs(title = "Jährliches durchschnittliches Maximum an täglichem Niederschlag \nim Zeitverlauf (aller Member)",
       y = "Jährliches durchschnittliches Maximum an täglichem Niederschlag \n(in mm/24h)",
       x = "Datum") +
  guides(color=guide_legend(title="Pegel")) +
    theme(text = element_text(size = 20),
          legend.position="bottom") +
    scale_color_brewer(palette = "Dark2")
ggsave("Plots/Chris/analysis/yearly_avg_max_prec.png", width = 12, height = 9)

ggplot(data = table_yearly_avg_max_airtmp, mapping = aes(x = YY, y = avg_max_airtemp, color = waterlevel)) +
  geom_line() +
  geom_point() +
  labs(title = "Jährliches durchschnittliches Maximum an täglicher Lufttemperatur \nim Zeitverlauf (aller Member)",
       y = "Jährliches durchschnittliches Maximum an täglicher Lufttemperatur \n(in °C)",
       x = "Datum") +
  guides(color=guide_legend(title="Pegel")) +
    theme(text = element_text(size = 20),
          legend.position="bottom") +
    scale_color_brewer(palette = "Dark2")
ggsave("Plots/Chris/analysis/yearly_avg_max_airtemp.png", width = 12, height = 9)

ggplot(data = table_yearly_avg_max_snowstorage, mapping = aes(x = YY, y = avg_max_snowstorage, color = waterlevel)) +
  geom_line() +
  geom_point() +
  labs(title = "Jährliches durchschnittliches Maximum an täglichem Schneespeicher \nim Zeitverlauf (aller Member)",
       y = "Jährliches durchschnittliches Maximum an täglichem Schneespeicher \n(in mm)",
       x = "Datum") +
  guides(color=guide_legend(title="Pegel")) +
    theme(text = element_text(size = 20),
          legend.position="bottom") +
    scale_color_brewer(palette = "Dark2")
ggsave("Plots/Chris/analysis/yearly_avg_max_snowstorage.png", width = 12, height = 9)

ggplot(data = table_yearly_avg_max_soilwater, mapping = aes(x = YY, y = avg_max_soilwater, color = waterlevel)) +
  geom_line() +
  geom_point() +
  labs(title = "Jährliches durchschnittliches Maximum an täglicher Oberflächennahe \nrelative Bodenfeuchte im Zeitverlauf (aller Member)",
       y = "Jährliches durchschnittliches Maximum an täglicher \noberflächennaher relative Bodenfeuchte (in %)",
       x = "Datum") +
  guides(color=guide_legend(title="Pegel")) +
    theme(text = element_text(size = 20),
          legend.position="bottom") +
    scale_color_brewer(palette = "Dark2")
ggsave("Plots/Chris/analysis/yearly_avg_max_soilwater.png", width = 12, height = 9)

```

## Stationary analysis
```{r}
library(tseries)

stationary_drainage_mean_p <- function(waterlevel, season) {
  name <- paste0("stationar_", season, "_", waterlevel, "_")
  member_names <- levels(hydro_total$member)
  for (i in 1:length(member_names)) {
    assign(paste0(name, i),
           kpss.test(get(paste0("hydro_", season, "_", waterlevel, "_", member_names[i]))$drainage)$p.value)
  }
  mean(get(paste0(name, "1")), get(paste0(name, "2")), get(paste0(name, "3")), get(paste0(name, "4")),
       get(paste0(name, "5")), get(paste0(name, "6")), get(paste0(name, "7")), get(paste0(name, "8")),
       get(paste0(name, "9")), get(paste0(name, "10")))
}

stationary_drainage_mean_p("10304", "winter")
stationary_drainage_mean_p("10304", "summer")
stationary_drainage_mean_p("11502", "winter")
stationary_drainage_mean_p("11502", "summer")
stationary_drainage_mean_p("20203", "winter")
stationary_drainage_mean_p("20203", "summer")
# nur die Zeitreihe von drainage für 20203/winter ist zum Signifikanzniveau 0.05 signifikant nicht-stationär;
# bei allen anderen Zeitreihen von drainage kann die Annahme der Stationarität nicht abgelehnt werden

stationary_lowlevel_mean_p <- function(waterlevel, season) {
  name <- paste0("stationar_", season, "_", waterlevel, "_")
  member_names <- levels(hydro_total$member)
  for (i in 1:length(member_names)) {
    assign(paste0(name, i),
           kpss.test(get(paste0("hydro_", season, "_", waterlevel, "_", member_names[i]))$lowlevel)$p.value)
  }
  mean(get(paste0(name, "1")), get(paste0(name, "2")), get(paste0(name, "3")), get(paste0(name, "4")),
       get(paste0(name, "5")), get(paste0(name, "6")), get(paste0(name, "7")), get(paste0(name, "8")),
       get(paste0(name, "9")), get(paste0(name, "10")))
}

stationary_lowlevel_mean_p("10304", "winter")
stationary_lowlevel_mean_p("10304", "summer")
stationary_lowlevel_mean_p("11502", "winter")
stationary_lowlevel_mean_p("11502", "summer")
stationary_lowlevel_mean_p("20203", "winter")
stationary_lowlevel_mean_p("20203", "summer")
# die Zeitreihen von lowlevel für 10304/winter, 20203/winter, 20203/summer sind zum Signifikanzniveau 0.05 signifikant nicht-stationär:
# für die Zeitreihen von lowlevel für 10304/summer, 11502/winter, 11502/summer kann die Annahme der Stationarität nicht abgelehnt werden

```

## Max: Analysis

```{r Max analysis}
theme_map <- theme_bw()+
  theme(panel.grid.major = element_line(colour = "transparent"))

plot(st_geometry(hydro_bavaria))

ggplot()+
  geom_sf(data = hydro_bavaria)



# Plot with catchment points
ggplot()+
  geom_sf(data = hydro_bavaria, fill = "transparent") +
  geom_sf(data = pegel_prop_sf, aes(color = as.factor(unique(ID))), size = 3)+
  labs(color = "Catchment ID")+
  scale_color_viridis_d()+
  theme_map
ggsave("./graphics/Max/Catchments_hydro_bavaria_dots.png", width = 12, height = 9)

# Plot hydrobavaria and admin bavaria
ggplot()+
  geom_sf(data = hydro_bavaria, fill = "white")+
  geom_sf(data = admin_bavaria, fill = "transparent", color = "red")+
  geom_sf(data = pegel_prop_sf, aes(color = as.factor(unique(ID))), size = 3)+
  labs(color = "Catchment ID")+
  scale_color_viridis_d()+
  theme_map
ggsave("./graphics/Max/hydro_admin_bavaria.png", width = 12, height = 9)

# Catchments with rivers and Donau/Main for orientation
waterways_three %>% 
  ggplot()+
  geom_sf(data = hydro_bavaria, fill = "transparent")+
  geom_sf(data = waterways_three, color = "blue", size = 1.5)+
  geom_sf(data = pegel_prop_sf, aes(color = as.factor(unique(ID))), size = 3)+
  labs(color = "Catchment ID")+
  scale_color_viridis_d()+
  theme_map

ggsave("./graphics/Max/map_rivers_catchments.png", width = 12, height = 9)

```

### tmap geographical overview
```{r}
tmap_mode("view")
tm_shape(hydro_bavaria)+
  tm_polygons(id = "NameString")+
  tm_shape(waterways_three)+
  tm_lines(col = "blue")+
  tm_shape(pegel_prop_sf)+
  tm_markers(size = 0.3)
```

## Average plots
```{r}
# boxplots for member distributions in 5 years intervals
plot_avg_member_boxplot <- function(data, var, startYY = 1990, endYY = 2020, by = 5, ...) {
  data %>% 
  group_by(YY, member) %>% 
  filter(YY %in% seq(startYY, endYY, by)) %>% 
  summarise(avg_var= mean(get(var))) %>% 
  mutate(YY = as.factor(YY)) %>% 
  ggplot(aes(x = YY, y = avg_var))+
  geom_boxplot()+
    labs(...)
}

plot_avg_member_boxplot(hydro_winter_10304, var = "drainage", x = "Year", y = "Avg drainage", title = "Winter 10304 (Isar Mittenwald) Average drainage")
plot_avg_member_boxplot(hydro_winter_10304, var = "airtmp", x = "Year", y = "Avg airtmp", title = "Winter 10304 (Isar Mittenwald) Average airtmp")
plot_avg_member_boxplot(hydro_winter_10304, var = "soilwater", x = "Year", y = "Avg soilwater", title = "Winter 10304 (Isar Mittenwald) Average soilwater")
plot_avg_member_boxplot(hydro_winter_10304, var = "precip", x = "Year", y = "Avg precip", title = "Winter 10304 (Isar Mittenwald) Average precip")

plot_avg_member_boxplot(hydro_summer_10304, var = "drainage", y = "Avg drainage", title = "Summer 10304 (Isar Mittenwald) Average drainage")
plot_avg_member_boxplot(hydro_summer_10304, var = "airtmp", y = "Avg airtmp", title = "Summer 10304 (Isar Mittenwald) Average airtmp")
plot_avg_member_boxplot(hydro_summer_10304, var = "soilwater", y = "Avg soilwater", title = "Summer 10304 (Isar Mittenwald) Average soilwater")
plot_avg_member_boxplot(hydro_summer_10304, var = "precip", y = "Avg precip", title = "Summerr 10304 (Isar Mittenwald) Average precip")

plot_avg_member_boxplot(hydro_winter_11502, var = "drainage", y = "Avg drainage", title = "Winter 11502 (Iller Kempten) Average drainage")
plot_avg_member_boxplot(hydro_winter_11502, var = "airtmp", y = "Avg airtmp", title = "Winter 11502 (Iller Kempten) Average airtmp")
plot_avg_member_boxplot(hydro_winter_11502, var = "soilwater", y = "Avg soilwater", title = "Winter 11502 (Iller Kempten) Average soilwater")
plot_avg_member_boxplot(hydro_winter_11502, var = "precip", y = "Avg precip", title = "Winter 11502 (Iller Kempten) Average precip")

plot_avg_member_boxplot(hydro_summer_11502, var = "drainage", y = "Avg drainage", title = "Summer 11502 (Iller Kempten) Average drainage")
plot_avg_member_boxplot(hydro_summer_11502, var = "airtmp", y = "Avg airtmp", title = "Summer 11502 (Iller Kempten) Average airtmp")
plot_avg_member_boxplot(hydro_summer_11502, var = "soilwater", y = "Avg soilwater", title = "Summer 11502 (Iller Kempten) Average soilwater")
plot_avg_member_boxplot(hydro_summer_11502, var = "precip", y = "Avg precip", title = "Summer 11502 (Iller Kempten) Average precip")

plot_avg_member_boxplot(hydro_winter_20203, var = "drainage", y = "Avg drainage", title = "Winter 20203 (Fränkische Saale Salz) Average drainage")
plot_avg_member_boxplot(hydro_winter_20203, var = "airtmp", y = "Avg airtmp", title = "Winter 20203 (Fränkische Saale Salz) Average airtmp")
plot_avg_member_boxplot(hydro_winter_20203, var = "soilwater", y = "Avg soilwater", title = "Winter 20203 (Fränkische Saale Salz) Average soilwater")
plot_avg_member_boxplot(hydro_winter_20203, var = "precip", y = "Avg precip", title = "Winter 20203 (Fränkische Saale Salz) Average precip")

plot_avg_member_boxplot(hydro_summer_20203, var = "drainage", y = "Avg drainage", title = "Summer 20203 (Fränkische Saale Salz) Average drainage")
plot_avg_member_boxplot(hydro_summer_20203, var = "airtmp", y = "Avg airtmp", title = "Summer 20203 (Fränkische Saale Salz) Average airtmp")
plot_avg_member_boxplot(hydro_summer_20203, var = "soilwater", y = "Avg soilwater", title = "Summer 20203 (Fränkische Saale Salz) Average soilwater")
plot_avg_member_boxplot(hydro_summer_20203, var = "precip", y = "Avg precip", title = "Summer 20203 (Fränkische Saale Salz) Average precip")


# average of averages across all members for whole time
plot_averages_across_members <- function(data, var, ...) {
  data %>%
  group_by(YY, member) %>%
  summarise(avg_var = mean(get(var))) %>%
  summarise(avg_var_per_year = mean(avg_var)) %>%
  ggplot(aes(x = YY, y = avg_var_per_year)) +
  geom_point() +
  geom_line() +
    labs(...)
}

plot_averages_across_members(hydro_winter_10304, var = "drainage", y = "Avg drainage across all members", title = "Winter 10304 (Isar Mittenwald) Avg drainage")
plot_averages_across_members(hydro_winter_10304, var = "airtmp", y = "Avg airtmp across all members", title = "Winter 10304 (Isar Mittenwald) Avg airtmp")
plot_averages_across_members(hydro_winter_10304, var = "soilwater", y = "Avg soilwater across all members", title = "Winter 10304 (Isar Mittenwald) Avg soilwater")
plot_averages_across_members(hydro_winter_10304, var = "precip", y = "Avg precip across all members", title = "Winter 10304 (Isar Mittenwald) Avg precip")

plot_averages_across_members(hydro_summer_10304, var = "drainage", y = "Avg drainage across all members", title = "Summer 10304 (Isar Mittenwald) Avg drainage")
plot_averages_across_members(hydro_summer_10304, var = "airtmp", y = "Avg airtmp across all members", title = "Summer 10304 (Isar Mittenwald) Avg airtmp")
plot_averages_across_members(hydro_summer_10304, var = "soilwater", y = "Avg soilwater across all members", title = "Summer 10304 (Isar Mittenwald) Avg soilwater")
plot_averages_across_members(hydro_summer_10304, var = "precip", y = "Avg precip across all members", title = "Summer 10304 (Isar Mittenwald) Avg precip")

plot_averages_across_members(hydro_winter_11502, var = "drainage", y = "Avg drainage across all members", title = "Winter 11502 (Iller Kempten) Avg drainage")
plot_averages_across_members(hydro_winter_11502, var = "airtmp", y = "Avg airtmp across all members", title = "Winter 11502 (Iller Kempten) Avg airtmp")
plot_averages_across_members(hydro_winter_11502, var = "soilwater", y = "Avg soilwater across all members", title = "Winter 11502 (Iller Kempten) Avg soilwater")
plot_averages_across_members(hydro_winter_11502, var = "precip", y = "Avg precip across all members", title = "Winter 11502 (Iller Kempten) Avg precip")

plot_averages_across_members(hydro_summer_11502, var = "drainage", y = "Avg drainage across all members", title = "Summer 11502 (Iller Kempten) Avg drainage")
plot_averages_across_members(hydro_summer_11502, var = "airtmp", y = "Avg airtmp across all members", title = "Summer 11502 (Iller Kempten) Avg airtmp")
plot_averages_across_members(hydro_summer_11502, var = "soilwater", y = "Avg soilwater across all members", title = "Summer 11502 (Iller Kempten) Avg soilwater")
plot_averages_across_members(hydro_summer_11502, var = "precip", y = "Avg precip across all members", title = "Summer 11502 (Iller Kempten) Avg precip")

plot_averages_across_members(hydro_winter_20203, var = "drainage", y = "Avg drainage across all members", title = "Winter 20203 (Fränkische Saale Salz) Avg drainage")
plot_averages_across_members(hydro_winter_20203, var = "airtmp", y = "Avg airtmp across all members", title = "Winter 20203 (Fränkische Saale Salz) Avg airtmp")
plot_averages_across_members(hydro_winter_20203, var = "soilwater", y = "Avg soilwater across all members", title = "Winter 20203 (Fränkische Saale Salz) Avg soilwater")
plot_averages_across_members(hydro_winter_20203, var = "precip", y = "Avg precip across all members", title = "Winter 20203 (Fränkische Saale Salz) Avg precip")

plot_averages_across_members(hydro_summer_20203, var = "drainage", y = "Avg drainage across all members", title = "Summer 20203 (Fränkische Saale Salz) Avg drainage")
plot_averages_across_members(hydro_summer_20203, var = "airtmp", y = "Avg airtmp across all members", title = "Summer 20203 (Fränkische Saale Salz) Avg airtmp")
plot_averages_across_members(hydro_summer_20203, var = "soilwater", y = "Avg soilwater across all members", title = "Summer 20203 (Fränkische Saale Salz) Avg soilwater")
plot_averages_across_members(hydro_summer_20203, var = "precip", y = "Avg precip across all members", title = "Summer 20203 (Fränkische Saale Salz) Avg precip")

```

# Time Series analysis for member kbe and one catchment (should later be genralised)
```{r}
hydro_summer_10304_kbe <- hydro_summer_10304 %>% 
  filter(member %in% "kbe") %>% 
  filter(name_waterlevel == 10304)

ts_hydro_summer_10304_kbe <- zoo(hydro_summer_10304_kbe[5:ncol(hydro_summer_10304_kbe)], hydro_summer_10304_kbe[["date"]])

plot.ts(ts_hydro_summer_10304_kbe$drainage)
plot.ts(window(ts_hydro_summer_10304_kbe$precip, start = '2015-4-01', end = '2015-09-30'))
plot.ts(window(ts_hydro_summer_10304_kbe$soilwater, start = '2015-4-01', end = '2015-09-30'))
plot.ts(window(ts_hydro_summer_10304_kbe$drainage, start = '2015-4-01', end = '2015-09-30'))
```
# Several member visualization
```{r}
hydro_summer_10304 %>% 
  filter(YY %in% seq(1990, 2020, 5)) %>% 
  ggplot(aes(x = date, y = avg_airtmp,col = member)) +
  geom_line(alpha = 0.2)+
  facet_wrap(~ YY, scales = "free_x")
```

```{r}
plot_ts_facet <- function(variable, data, period = 5, ...) {
  data %>% 
  filter(YY %in% seq(1990, 2020, period)) %>% 
  ggplot(aes_string(x = "date", y = variable, col = "member")) +
  geom_path(alpha = 0.2)+
  facet_wrap(~ YY, scales = "free_x")+
    labs(...)
}
```
 
# Summer
```{r}
plot_ts_facet("avg_airtmp", hydro_summer_10304, period = 5, title = 10304)
plot_ts_facet("avg_airtmp", hydro_summer_11502, period = 5, title = 11502)
plot_ts_facet("avg_airtmp", hydro_summer_20203, period = 5, title = 20203)

plot_ts_facet("avg_relhum", hydro_summer_10304, period = 5, title = 10304)
plot_ts_facet("avg_relhum", hydro_summer_11502, period = 5, title = 11502)
plot_ts_facet("avg_relhum", hydro_summer_20203, period = 5, title = 20203)

plot_ts_facet("avg_glorad", hydro_summer_10304, period = 5, title = 10304)
plot_ts_facet("avg_glorad", hydro_summer_11502, period = 5, title = 11502)
plot_ts_facet("avg_glorad", hydro_summer_20203, period = 5, title = 20203)
```

# Winter (needs work on the axis)
```{r}
plot_ts_facet("avg_airtmp", hydro_winter_10304, period = 5, title = 10304)
plot_ts_facet("avg_airtmp", hydro_winter_11502, period = 5, title = 11502)
plot_ts_facet("avg_airtmp", hydro_winter_20203, period = 5, title = 20203)

plot_ts_facet("avg_relhum", hydro_winter_10304, period = 5, title = 10304)
plot_ts_facet("avg_relhum", hydro_winter_11502, period = 5, title = 11502)
plot_ts_facet("avg_relhum", hydro_winter_20203, period = 5, title = 20203)

plot_ts_facet("avg_glorad", hydro_winter_10304, period = 5, title = 10304)
plot_ts_facet("avg_glorad", hydro_winter_11502, period = 5, title = 11502)
plot_ts_facet("avg_glorad", hydro_winter_20203, period = 5, title = 20203)
```

### Glm - Linear trend over time 
```{r}
model_1 <- glm(lowlevel ~ date  + avg_airtmp + avg_soilwater + avg_precip + avg_precip * avg_soilwater, data = hydro_summer_10304_kbe, family = binomial)
summary(model_1)

model_2 <- glm(lowlevel ~ date  + avg_airtmp + avg_soilwater + avg_precip + avg_precip * avg_soilwater + avg_snowstorage + avg_glorad  + avg_infiltration, data = hydro_summer_10304_kbe, family = binomial)
summary(model_2)

# generalized linear mixed-effects model with random intercept for member (no interactions)
library(lme4)
glmer_1 <- glmer(lowlevel ~ precip + airtmp + glorad + relhum + soilwater + snowstorage + groundwaterdepth + infiltration + (1|member), data = hydro_winter_10304, family = binomial())
summary(glmer_1)
```
# GAM
```{r}
library(mgcv)
gam_1 <- gam(lowlevel ~ date + s(avg_airtmp) + s(avg_soilwater) + s(avg_precip) + avg_precip * avg_soilwater + avg_snowstorage + s(avg_glorad) + s(avg_infiltration), data = hydro_summer_10304_kbe, family = binomial(), method = "REML")
summary(gam_1)

gam_1_s_interac <- gam(lowlevel ~ s(precip) + s(airtmp) + s(glorad) + s(relhum) + s(soilwater) + s(snowstorage) + s(groundwaterdepth) + s(infiltration) + s(precip, by = soilwater), data = hydro_summer_10304, family = binomial(), method = "REML")
summary(gam_1_s_interac)
plot(gam_1_s_interac)

## gam mit glatten Effekten (penalized B-splines) und member als random Effekt
# 10304, winter
gam_randinter_member_10304_winter <- gam(lowlevel ~ date + s(precip, bs = "ps") + s(airtmp, bs = "ps") + s(glorad, bs = "ps") + s(relhum, bs = "ps") + s(soilwater, bs = "ps") + s(snowstorage, bs = "ps") + s(groundwaterdepth, bs = "ps") + s(infiltration, bs = "ps") + s(member, bs = "re"), data = hydro_winter_10304, family = binomial(), method = "REML")
summary(gam_randinter_member_10304_winter)
plot(gam_randinter_member_10304_winter)

# 10304, summer
gam_randinter_member_10304_summer <- gam(lowlevel ~ date + s(precip, bs = "ps") + s(airtmp, bs = "ps") + s(glorad, bs = "ps") + s(relhum, bs = "ps") + s(soilwater, bs = "ps") + s(snowstorage, bs = "ps") + s(groundwaterdepth, bs = "ps") + s(infiltration, bs = "ps") + s(member, bs = "re"), data = hydro_summer_10304, family = binomial(), method = "REML")
summary(gam_randinter_member_10304_summer)
plot(gam_randinter_member_10304_summer)

# 11502, winter
gam_randinter_member_11502_winter <- gam(lowlevel ~ date + s(precip, bs = "ps") + s(airtmp, bs = "ps") + s(glorad, bs = "ps") + s(relhum, bs = "ps") + s(soilwater, bs = "ps") + s(snowstorage, bs = "ps") + s(groundwaterdepth, bs = "ps") + s(infiltration, bs = "ps") + s(member, bs = "re"), data = hydro_winter_11502, family = binomial(), method = "REML")
summary(gam_randinter_member_11502_winter)
plot(gam_randinter_member_11502_winter)

# 11502, summer
gam_randinter_member_11502_summer <- gam(lowlevel ~ date + s(precip, bs = "ps") + s(airtmp, bs = "ps") + s(glorad, bs = "ps") + s(relhum, bs = "ps") + s(soilwater, bs = "ps") + s(snowstorage, bs = "ps") + s(groundwaterdepth, bs = "ps") + s(infiltration, bs = "ps") + s(member, bs = "re"), data = hydro_summer_11502, family = binomial(), method = "REML")
summary(gam_randinter_member_11502_summer)
plot(gam_randinter_member_11502_summer)

# 20203, winter
gam_randinter_member_20203_winter <- gam(lowlevel ~ date + s(precip, bs = "ps") + s(airtmp, bs = "ps") + s(glorad, bs = "ps") + s(relhum, bs = "ps") + s(soilwater, bs = "ps") + s(snowstorage, bs = "ps") + s(groundwaterdepth, bs = "ps") + s(infiltration, bs = "ps") + s(member, bs = "re"), data = hydro_winter_20203, family = binomial(), method = "REML")
summary(gam_randinter_member_20203_winter)
plot(gam_randinter_member_20203_winter)

# 20203, summer
gam_randinter_member_20203_summer <- gam(lowlevel ~ date + s(precip, bs = "ps") + s(airtmp, bs = "ps") + s(glorad, bs = "ps") + s(relhum, bs = "ps") + s(soilwater, bs = "ps") + s(snowstorage, bs = "ps") + s(groundwaterdepth, bs = "ps") + s(infiltration, bs = "ps") + s(member, bs = "re"), data = hydro_summer_20203, family = binomial(), method = "REML")
summary(gam_randinter_member_20203_summer)
plot(gam_randinter_member_20203_summer)

gam_randinter_member_ps <- gam(lowlevel ~ s(precip, bs = "ps") + s(airtmp, bs = "ps") + s(glorad, bs = "ps") + s(relhum, bs = "ps") + s(soilwater, bs = "ps") + s(snowstorage, bs = "ps") + s(groundwaterdepth, bs = "ps") + s(infiltration, bs = "ps") + s(precip, by = soilwater, bs = "ps") + s(member, bs = "re"), data = hydro_winter_10304, family = binomial(), method = "REML")
summary(gam_randinter_member_ps)
plot(gam_randinter_member_ps)


# generalized additive mixed model with ARMA-correlation-structure for member kbe
gamm_randinter_member_ps_corAR1 <- gamm(lowlevel ~ s(precip, bs = "ps") + s(airtmp, bs = "ps") + s(glorad, bs = "ps") + s(relhum, bs = "ps") + s(soilwater, bs = "ps") + s(snowstorage, bs = "ps") + s(groundwaterdepth, bs = "ps") + s(infiltration, bs = "ps") + s(precip, by = soilwater, bs = "ps") + s(member, bs = "re"), data = hydro_winter_10304, family = binomial(), correlation = corCAR1(form = ~ date | member))
# Ausprobieren: corARMA(p = 4, q = 1)
summary(gamm_randinter_member_ps_corAR1)


gam_2 <- gam(lowlevel ~ date + s(airtmp) + s(soilwater) + s(precip) + s(soilwater, precip), data = hydro_summer_10304_kbe, family = binomial())
summary(gam_2)


```
# P Splines
```{r}
gam_1_ps <- gam(lowlevel ~ date  + s(avg_airtmp, bs = "ps") + s(avg_soilwater, bs = "ps") + s(avg_precip, bs = "ps") + avg_precip * avg_soilwater + avg_snowstorage + s(avg_glorad, bs = "ps")  + s(avg_infiltration, bs = "ps"), data = hydro_summer_10304_kbe, family = binomial(), method = "REML")
summary(gam_1_ps)

gam_2_ps <- gam(lowlevel ~ date + s(airtmp, bs = "ps") + s(soilwater, bs = "ps") + s(precip, bs = "ps") + s(soilwater, by = precip, bs = "ps"), data = hydro_summer_10304_kbe, family = binomial())

summary(gam_2_ps)
```

# ARIMA-Models
```{r}
library(forecast)

model_Arima <- Arima(hydro_winter_10304_kbe$lowlevel,xreg = as.matrix(subset(hydro_winter_10304_kbe, select = c(precip, airtmp, glorad, relhum, soilwater, snowstorage, groundwaterdepth, infiltration))), order = c(4, 0, 7))
summary(model_Arima)

acf(resid(model_Arima))
```

### Auto corr
```{r}
library(car)

## drainage
# autocorrelation function, mean acf for drainage (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_acf_drainage_", k, "_", i), data.frame(Names = 1:38))
    for (j in levels(hydro_total$member)) {
      assign(paste0("acf_drainage_", k, "_", i, "_", j), as.data.frame(acf(get(paste0("hydro_", k, "_", i, "_", j))$drainage, plot = FALSE)$acf))
      assign(paste0("df_acf_drainage_", k, "_", i), bind_cols(get(paste0("df_acf_drainage_", k, "_", i)), get(paste0("acf_drainage_", k, "_", i, "_", j))))
    }
    assign(paste0("acf_mean_drainage_", k, "_", i), rowMeans(get(paste0("df_acf_drainage_", k, "_", i))[, 2:11]))
  }
}
# -> Drainage ist in allen Teildatensätzen positiv autokorreliert -> Modell, das diese Autokorrelation berücksichtigt, nötig

# ACF-Plots for drainage (across all members) separated by each waterlevel and season
plot(x = 0:37, y = acf_mean_drainage_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Abflusses für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_drainage_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Abflusses für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_drainage_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Abflusses für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_drainage_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Abflusses für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_drainage_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Abflusses für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_drainage_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Abflusses für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

# Partial autocorrelation function, mean pacf for drainage (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_pacf_drainage_", k, "_", i), data.frame(Names = 1:37))
    for (j in levels(hydro_total$member)) {
      assign(paste0("pacf_drainage_", k, "_", i, "_", j),
             as.data.frame(pacf(get(paste0("hydro_", k, "_", i, "_", j))$drainage, plot = FALSE)$acf))
      assign(paste0("df_pacf_drainage_", k, "_", i),
             bind_cols(get(paste0("df_pacf_drainage_", k, "_", i)), get(paste0("pacf_drainage_", k, "_", i, "_", j))))
    }
    assign(paste0("pacf_mean_drainage_", k, "_", i), rowMeans(get(paste0("df_pacf_drainage_", k, "_", i))[, 2:11]))
  }
}
# 10304, Winter: Autokorrelationskoeffizient bis lag = 2 (durchgängig) signifikant
# 10304, Summer: Autokorrelationskoeffizient bis lag = 3 (durchgängig) signifikant
# 11502, Winter: Autokorrelationskoeffizient bis lag = 5 (nicht durchgängig), bis lag = 3 (durchgängig) signifikant
# 11502, Summer: Autokorrelationskoeffizient bis lag = 3 (nicht durchgängig), bis lag = 1 (durchgängig) signifikant
# 20203, Winter: Autokorrelationskoeffizient bis lag = 5 (nicht durchgängig), bis lag = 3 (durchgängig) signifikant
# 20203, Summer: Autokorrelationskoeffizient bis lag = 5 (nicht durchgängig), bis lag = 3 (durchgängig) signifikant

# PACF-Plots for drainage (across all members) separated by each waterlevel and season
plot(x = 1:37, y = pacf_mean_drainage_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Abflusses für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_drainage_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Abflusses für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_drainage_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Abflusses für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_drainage_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Abflusses für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_drainage_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Abflusses für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_drainage_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Abflusses für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")


## lowlevel
# autocorrelation function, mean acf for lowlevel (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_acf_lowlevel_", k, "_", i), data.frame(Names = 1:38))
    for (j in levels(hydro_total$member)) {
      assign(paste0("acf_lowlevel_", k, "_", i, "_", j), as.data.frame(acf(get(paste0("hydro_", k, "_", i, "_", j))$lowlevel, plot = FALSE)$acf))
      assign(paste0("df_acf_lowlevel_", k, "_", i), bind_cols(get(paste0("df_acf_lowlevel_", k, "_", i)), get(paste0("acf_lowlevel_", k, "_", i, "_", j))))
    }
    assign(paste0("acf_mean_lowlevel_", k, "_", i), rowMeans(get(paste0("df_acf_lowlevel_", k, "_", i))[, 2:11]))
  }
}
# -> Lowlevel ist in allen Teildatensätzen positiv autokorreliert -> Modell, das diese Autokorrelation berücksichtigt, nötig

# ACF-Plots for lowlevel (across all members) separated by each waterlevel and season
plot(x = 0:37, y = acf_mean_lowlevel_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. von Niedrigwasserevents für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_lowlevel_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. von Niedrigwasserevents für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_lowlevel_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. von Niedrigwasserevents für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_lowlevel_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. von Niedrigwasserevents für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_lowlevel_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. von Niedrigwasserevents für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_lowlevel_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. von Niedrigwasserevents für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

# Partial autocorrelation function, mean pacf for lowlevel (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_pacf_lowlevel_", k, "_", i), data.frame(Names = 1:37))
    for (j in levels(hydro_total$member)) {
      assign(paste0("pacf_lowlevel_", k, "_", i, "_", j),
             as.data.frame(pacf(get(paste0("hydro_", k, "_", i, "_", j))$lowlevel, plot = FALSE)$acf))
      assign(paste0("df_pacf_lowlevel_", k, "_", i),
             bind_cols(get(paste0("df_pacf_lowlevel_", k, "_", i)), get(paste0("pacf_lowlevel_", k, "_", i, "_", j))))
    }
    assign(paste0("pacf_mean_lowlevel_", k, "_", i), rowMeans(get(paste0("df_pacf_lowlevel_", k, "_", i))[, 2:11]))
  }
}
# 10304, Winter: Autokorrelationskoeffizient bis lag = 4 (nicht durchgängig), bis lag = 1 (durchgängig) signifikant
# 10304, Summer: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant
# 11502, Winter: Autokorrelationskoeffizient bis lag = 4 (nicht durchgängig), bis lag = 1 (durchgängig) signifikant
# 11502, Summer: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant
# 20203, Winter: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant
# 20203, Summer: Autokorrelationskoeffizient bis lag = 5 (nicht durchgängig), bis lag = 1 (durchgängig) signifikant

# PACF-Plots for lowlevel (across all members) seperated by each waterlevel and season
plot(x = 1:37, y = pacf_mean_lowlevel_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. v. Niedrigwasserevents für Isar Mittenw., Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_lowlevel_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. von Niedrigwasserevents für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_lowlevel_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. von Niedrigwasserevents für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_lowlevel_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. von Niedrigwasserevents für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_lowlevel_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. von Niedrigwasserevents für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_lowlevel_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. von Niedrigwasserevents für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

# DurbinWatsonTest für GAM auf Datensatz hydro_winter_10304_kbe
durbinWatsonTest(gam_1)
# p < 0.05, Wert der Teststatistik: 0.3839 -> Es scheint positive Autokorrelation vorzuliegen

### Driver
## Precip
# autocorrelation function, mean acf for precip (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_acf_precip_", k, "_", i), data.frame(Names = 1:38))
    for (j in levels(hydro_total$member)) {
      assign(paste0("acf_precip_", k, "_", i, "_", j),
             as.data.frame(acf(get(paste0("hydro_", k, "_", i, "_", j))$precip, plot = FALSE)$acf))
      assign(paste0("df_acf_precip_", k, "_", i),
             bind_cols(get(paste0("df_acf_precip_", k, "_", i)), get(paste0("acf_precip_", k, "_", i, "_", j))))
    }
    assign(paste0("acf_mean_precip_", k, "_", i), rowMeans(get(paste0("df_acf_precip_", k, "_", i))[, 2:11]))
  }
}
# -> Precip ist in allen Teildatensätzen leicht positiv autokorreliert -> Modell, das diese Autokorrelation berücksichtigt, wäre von Vorteil

# ACF-Plots for precip (across all members) separated by each waterlevel and season
plot(x = 0:37, y = acf_mean_precip_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Niederschlags für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_precip_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Niederschlags für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_precip_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Niederschlags für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_precip_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Niederschlags für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_precip_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Niederschlags für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_precip_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Niederschlags für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

# partial autocorrelation function, mean pacf for precip (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_pacf_precip_", k, "_", i), data.frame(Names = 1:37))
    for (j in levels(hydro_total$member)) {
      assign(paste0("pacf_precip_", k, "_", i, "_", j),
             as.data.frame(pacf(get(paste0("hydro_", k, "_", i, "_", j))$precip, plot = FALSE)$acf))
      assign(paste0("df_pacf_precip_", k, "_", i),
             bind_cols(get(paste0("df_pacf_precip_", k, "_", i)), get(paste0("pacf_precip_", k, "_", i, "_", j))))
    }
    assign(paste0("pacf_mean_precip_", k, "_", i), rowMeans(get(paste0("df_pacf_precip_", k, "_", i))[, 2:11]))
  }
}
# 10304, Winter: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant
# 10304, Summer: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant
# 11502, Winter: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant
# 11502, Summer: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant
# 20203, Winter: Autokorrelationskoeffizient bis lag = 2 (durchgängig) signifikant
# 20203, Summer: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant

# PACF-Plots for precip (across all members) seperated by each waterlevel and season
plot(x = 1:37, y = pacf_mean_precip_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Niederschlags für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_precip_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Niederschlags für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_precip_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Niederschlags für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_precip_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Niederschlags für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_precip_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Niederschlags für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_precip_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Niederschlags für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")


## Airtmp
# autocorrelation function, mean acf for airtmp (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_acf_airtmp_", k, "_", i), data.frame(Names = 1:38))
    for (j in levels(hydro_total$member)) {
      assign(paste0("acf_airtmp_", k, "_", i, "_", j),
             as.data.frame(acf(get(paste0("hydro_", k, "_", i, "_", j))$airtmp, plot = FALSE)$acf))
      assign(paste0("df_acf_airtmp_", k, "_", i),
             bind_cols(get(paste0("df_acf_airtmp_", k, "_", i)), get(paste0("acf_airtmp_", k, "_", i, "_", j))))
    }
    assign(paste0("acf_mean_airtmp_", k, "_", i), rowMeans(get(paste0("df_acf_airtmp_", k, "_", i))[, 2:11]))
  }
}
# -> Airtmp ist in allen Teildatensätzen positiv autokorreliert -> Modell, das diese Autokorrelation berücksichtigt, nötig

# ACF-Plots for airtmp (across all members) separated by each waterlevel and season
plot(x = 0:37, y = acf_mean_airtmp_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Autokor. zw. Beob. der Temperatur für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_airtmp_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Autokor. zw. Beob. der Temperatur für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_airtmp_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Autokor. zw. Beob. der Temperatur für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_airtmp_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Autokor. zw. Beob. der Temperatur für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_airtmp_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Autokor. zw. Beob. der Temperatur für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_airtmp_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Autokor. zw. Beob. der Temperatur für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

# partial autocorrelation function, mean pacf for airtmp (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_pacf_airtmp_", k, "_", i), data.frame(Names = 1:37))
    for (j in levels(hydro_total$member)) {
      assign(paste0("pacf_airtmp_", k, "_", i, "_", j),
             as.data.frame(pacf(get(paste0("hydro_", k, "_", i, "_", j))$airtmp, plot = FALSE)$acf))
      assign(paste0("df_pacf_airtmp_", k, "_", i),
             bind_cols(get(paste0("df_pacf_airtmp_", k, "_", i)), get(paste0("pacf_airtmp_", k, "_", i, "_", j))))
    }
    assign(paste0("pacf_mean_airtmp_", k, "_", i), rowMeans(get(paste0("df_pacf_airtmp_", k, "_", i))[, 2:11]))
  }
}
# 10304, Winter: Autokorrelationskoeffizient bis lag = 5 (nicht durchgängig), bis lag = 3 (durchgängig) signifikant
# 10304, Summer: Autokorrelationskoeffizient bis lag = 7 (nicht durchgängig), bis lag = 3 (durchgängig) signifikant
# 11502, Winter: Autokorrelationskoeffizient bis lag = 5 (nicht durchgängig), bis lag = 3 (durchgängig) signifikant
# 11502, Summer: Autokorrelationskoeffizient bis lag = 7 (nicht durchgängig), bis lag = 3 (durchgängig) signifikant
# 20203, Winter: Autokorrelationskoeffizient bis lag = 5 (durchgängig) signifikant
# 20203, Summer: Autokorrelationskoeffizient bis lag = 6 (durchgängig) signifikant

# PACF-Plots for airtmp (across all members) seperated by each waterlevel and season
plot(x = 1:37, y = pacf_mean_airtmp_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der Temperatur für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_airtmp_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der Temperatur für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_airtmp_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der Temperatur für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_airtmp_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der Temperatur für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_airtmp_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der Temperatur für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_airtmp_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der Temperatur für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

## Glorad
# autocorrelation function, mean acf for glorad (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_acf_glorad_", k, "_", i), data.frame(Names = 1:38))
    for (j in levels(hydro_total$member)) {
      assign(paste0("acf_glorad_", k, "_", i, "_", j),
             as.data.frame(acf(get(paste0("hydro_", k, "_", i, "_", j))$glorad, plot = FALSE)$acf))
      assign(paste0("df_acf_glorad_", k, "_", i),
             bind_cols(get(paste0("df_acf_glorad_", k, "_", i)), get(paste0("acf_glorad_", k, "_", i, "_", j))))
    }
    assign(paste0("acf_mean_glorad_", k, "_", i), rowMeans(get(paste0("df_acf_glorad_", k, "_", i))[, 2:11]))
  }
}
# -> Glorad ist in allen Teildatensätzen positiv autokorreliert -> Modell, das diese Autokorrelation berücksichtigt, nötig

# ACF-Plots for glorad (across all members) separated by each waterlevel and season
plot(x = 0:37, y = acf_mean_glorad_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der einfall. kurzw. Strahlung für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_glorad_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der einfall. kurzw. Strahlung für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_glorad_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der einfall. kurzw. Strahlung für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_glorad_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der einfall. kurzw. Strahlung für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_glorad_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der einfall. kurzw. Strahlung für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_glorad_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der einfall. kurzw. Strahlung für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

# partial autocorrelation function, mean pacf for glorad (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_pacf_glorad_", k, "_", i), data.frame(Names = 1:37))
    for (j in levels(hydro_total$member)) {
      assign(paste0("pacf_glorad_", k, "_", i, "_", j),
             as.data.frame(pacf(get(paste0("hydro_", k, "_", i, "_", j))$glorad, plot = FALSE)$acf))
      assign(paste0("df_pacf_glorad_", k, "_", i),
             bind_cols(get(paste0("df_pacf_glorad_", k, "_", i)), get(paste0("pacf_glorad_", k, "_", i, "_", j))))
    }
    assign(paste0("pacf_mean_glorad_", k, "_", i), rowMeans(get(paste0("df_pacf_glorad_", k, "_", i))[, 2:11]))
  }
}
# 10304, Winter: Autokorrelationskoeffizient bis lag = 7 (durchgängig) signifikant
# 10304, Summer: Autokorrelationskoeffizient bis lag = 9 (durchgängig) signifikant
# 11502, Winter: Autokorrelationskoeffizient bis lag = 7 (durchgängig) signifikant
# 11502, Summer: Autokorrelationskoeffizient bis lag = 8 (durchgängig) signifikant
# 20203, Winter: Autokorrelationskoeffizient bis lag = 6 (durchgängig) signifikant
# 20203, Summer: Autokorrelationskoeffizient bis lag = 7 (durchgängig) signifikant

# PACF-Plots for glorad (across all members) seperated by each waterlevel and season
plot(x = 1:37, y = pacf_mean_glorad_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der einfall. kurzw. Strahlung für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_glorad_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der einfall. kurzw. Strahlung für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_glorad_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der einfall. kurzw. Strahlung für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_glorad_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der einfall. kurzw. Strahlung für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_glorad_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der einfall. kurzw. Strahlung für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_glorad_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der einfall. kurzw. Strahlung für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")


## Relhum
# autocorrelation function, mean acf for relhum (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_acf_relhum_", k, "_", i), data.frame(Names = 1:38))
    for (j in levels(hydro_total$member)) {
      assign(paste0("acf_relhum_", k, "_", i, "_", j),
             as.data.frame(acf(get(paste0("hydro_", k, "_", i, "_", j))$relhum, plot = FALSE)$acf))
      assign(paste0("df_acf_relhum_", k, "_", i),
             bind_cols(get(paste0("df_acf_relhum_", k, "_", i)), get(paste0("acf_relhum_", k, "_", i, "_", j))))
    }
    assign(paste0("acf_mean_relhum_", k, "_", i), rowMeans(get(paste0("df_acf_relhum_", k, "_", i))[, 2:11]))
  }
}
# -> Relhum ist in allen Teildatensätzen positiv autokorreliert (vor allem für Pegel 20203) -> Modell, das diese Autokorrelation berücksichtigt, nötig

# ACF-Plots for relhum (across all members) separated by each waterlevel and season
plot(x = 0:37, y = acf_mean_relhum_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der relativen Luftfeuchte für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_relhum_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der relativen Luftfeuchte für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_relhum_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der relativen Luftfeuchte für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_relhum_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der relativen Luftfeuchte für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_relhum_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der relativen Luftfeuchte für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_relhum_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der relativen Luftfeuchte für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

# partial autocorrelation function, mean pacf for relhum (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_pacf_relhum_", k, "_", i), data.frame(Names = 1:37))
    for (j in levels(hydro_total$member)) {
      assign(paste0("pacf_relhum_", k, "_", i, "_", j),
             as.data.frame(pacf(get(paste0("hydro_", k, "_", i, "_", j))$relhum, plot = FALSE)$acf))
      assign(paste0("df_pacf_relhum_", k, "_", i),
             bind_cols(get(paste0("df_pacf_relhum_", k, "_", i)), get(paste0("pacf_relhum_", k, "_", i, "_", j))))
    }
    assign(paste0("pacf_mean_relhum_", k, "_", i), rowMeans(get(paste0("df_pacf_relhum_", k, "_", i))[, 2:11]))
  }
}
# 10304, Winter: Autokorrelationskoeffizient bis lag = 3 (durchgängig) signifikant
# 10304, Summer: Autokorrelationskoeffizient bis lag = 3 (durchgängig) signifikant
# 11502, Winter: Autokorrelationskoeffizient bis lag = 3 (durchgängig) signifikant
# 11502, Summer: Autokorrelationskoeffizient bis lag = 3 (durchgängig) signifikant
# 20203, Winter: Autokorrelationskoeffizient bis lag = 5 (durchgängig) signifikant
# 20203, Summer: Autokorrelationskoeffizient bis lag = 4 (nicht durchgängig), bis lag = 1 (durchgängig) signifikant

# PACF-Plots for relhum (across all members) seperated by each waterlevel and season
plot(x = 1:37, y = pacf_mean_relhum_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der relativen Luftfeuchte für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_relhum_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der relativen Luftfeuchte für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_relhum_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der relativen Luftfeuchte für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_relhum_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der relativen Luftfeuchte für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_relhum_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der relativen Luftfeuchte für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_relhum_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der relativen Luftfeuchte für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

## Soilwater
# autocorrelation function, mean acf for soilwater (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_acf_soilwater_", k, "_", i), data.frame(Names = 1:38))
    for (j in levels(hydro_total$member)) {
      assign(paste0("acf_soilwater_", k, "_", i, "_", j),
             as.data.frame(acf(get(paste0("hydro_", k, "_", i, "_", j))$soilwater, plot = FALSE)$acf))
      assign(paste0("df_acf_soilwater_", k, "_", i),
             bind_cols(get(paste0("df_acf_soilwater_", k, "_", i)), get(paste0("acf_soilwater_", k, "_", i, "_", j))))
    }
    assign(paste0("acf_mean_soilwater_", k, "_", i), rowMeans(get(paste0("df_acf_soilwater_", k, "_", i))[, 2:11]))
  }
}
# -> Soilwater ist in allen Teildatensätzen positiv autokorreliert -> Modell, das diese Autokorrelation berücksichtigt, nötig

# ACF-Plots for soilwater (across all members) separated by each waterlevel and season
plot(x = 0:37, y = acf_mean_soilwater_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der oberflächennahen Bodenfeuchte für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_soilwater_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der oberflächennahen Bodenfeuchte für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_soilwater_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der oberflächennahen Bodenfeuchte für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_soilwater_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der oberflächennahen Bodenfeuchte für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_soilwater_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der oberflächennahen Bodenfeuchte für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_soilwater_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der oberflächennahen Bodenfeuchte für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

# partial autocorrelation function, mean pacf for soilwater (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_pacf_soilwater_", k, "_", i), data.frame(Names = 1:37))
    for (j in levels(hydro_total$member)) {
      assign(paste0("pacf_soilwater_", k, "_", i, "_", j),
             as.data.frame(pacf(get(paste0("hydro_", k, "_", i, "_", j))$soilwater, plot = FALSE)$acf))
      assign(paste0("df_pacf_soilwater_", k, "_", i),
             bind_cols(get(paste0("df_pacf_soilwater_", k, "_", i)), get(paste0("pacf_soilwater_", k, "_", i, "_", j))))
    }
    assign(paste0("pacf_mean_soilwater_", k, "_", i), rowMeans(get(paste0("df_pacf_soilwater_", k, "_", i))[, 2:11]))
  }
}
# 10304, Winter: Autokorrelationskoeffizient bis lag = 2 (durchgängig) signifikant
# 10304, Summer: Autokorrelationskoeffizient bis lag = 3 (durchgängig) signifikant
# 11502, Winter: Autokorrelationskoeffizient bis lag = 3 (durchgängig) signifikant
# 11502, Summer: Autokorrelationskoeffizient bis lag = 3 (durchgängig) signifikant
# 20203, Winter: Autokorrelationskoeffizient bis lag = 2 (durchgängig) signifikant
# 20203, Summer: Autokorrelationskoeffizient bis lag = 2 (durchgängig) signifikant

# PACF-Plots for soilwater (across all members) seperated by each waterlevel and season
plot(x = 1:37, y = pacf_mean_soilwater_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der oberflächennahen Bodenfeuchte für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_soilwater_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der oberflächennahen Bodenfeuchte für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_soilwater_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der oberflächennahen Bodenfeuchte für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_soilwater_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der oberflächennahen Bodenfeuchte für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_soilwater_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der oberflächennahen Bodenfeuchte für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_soilwater_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der oberflächennahen Bodenfeuchte für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")


## Snowstorage
# autocorrelation function, mean acf for snowstorage (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_acf_snowstorage_", k, "_", i), data.frame(Names = 1:38))
    for (j in levels(hydro_total$member)) {
      assign(paste0("acf_snowstorage_", k, "_", i, "_", j),
             as.data.frame(acf(get(paste0("hydro_", k, "_", i, "_", j))$snowstorage, plot = FALSE)$acf))
      assign(paste0("df_acf_snowstorage_", k, "_", i),
             bind_cols(get(paste0("df_acf_snowstorage_", k, "_", i)), get(paste0("acf_snowstorage_", k, "_", i, "_", j))))
    }
    assign(paste0("acf_mean_snowstorage_", k, "_", i), rowMeans(get(paste0("df_acf_snowstorage_", k, "_", i))[, 2:11]))
  }
}
# -> Snowstorage ist in allen Teildatensätzen positiv autokorreliert -> Modell, das diese Autokorrelation berücksichtigt, nötig

# ACF-Plots for snowstorage (across all members) separated by each waterlevel and season
plot(x = 0:37, y = acf_mean_snowstorage_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Schneespeichers für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_snowstorage_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Schneespeichers für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_snowstorage_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Schneespeichers für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_snowstorage_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Schneespeichers für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_snowstorage_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Schneespeichers für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_snowstorage_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Schneespeichers für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

# partial autocorrelation function, mean pacf for snowstorage (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_pacf_snowstorage_", k, "_", i), data.frame(Names = 1:37))
    for (j in levels(hydro_total$member)) {
      assign(paste0("pacf_snowstorage_", k, "_", i, "_", j),
             as.data.frame(pacf(get(paste0("hydro_", k, "_", i, "_", j))$snowstorage, plot = FALSE)$acf))
      assign(paste0("df_pacf_snowstorage_", k, "_", i),
             bind_cols(get(paste0("df_pacf_snowstorage_", k, "_", i)), get(paste0("pacf_snowstorage_", k, "_", i, "_", j))))
    }
    assign(paste0("pacf_mean_snowstorage_", k, "_", i), rowMeans(get(paste0("df_pacf_snowstorage_", k, "_", i))[, 2:11]))
  }
}
# 10304, Winter: Autokorrelationskoeffizient bis lag = 3 (durchgängig) signifikant
# 10304, Summer: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant
# 11502, Winter: Autokorrelationskoeffizient bis lag = 4 (durchgängig) signifikant
# 11502, Summer: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant
# 20203, Winter: Autokorrelationskoeffizient bis lag = 3 (durchgängig) signifikant
# 20203, Summer: Autokorrelationskoeffizient bis lag = 2 (durchgängig) signifikant

# PACF-Plots for snowstorage (across all members) seperated by each waterlevel and season
plot(x = 1:37, y = pacf_mean_snowstorage_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Schneespeichers für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_snowstorage_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Schneespeichers für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_snowstorage_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Schneespeichers für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_snowstorage_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Schneespeichers für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_snowstorage_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Schneespeichers für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_snowstorage_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Schneespeichers für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")


## Groundwaterdepth
# autocorrelation function, mean acf for groundwaterdepth (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_acf_groundwaterdepth_", k, "_", i), data.frame(Names = 1:38))
    for (j in levels(hydro_total$member)) {
      assign(paste0("acf_groundwaterdepth_", k, "_", i, "_", j),
             as.data.frame(acf(get(paste0("hydro_", k, "_", i, "_", j))$groundwaterdepth, plot = FALSE)$acf))
      assign(paste0("df_acf_groundwaterdepth_", k, "_", i),
             bind_cols(get(paste0("df_acf_groundwaterdepth_", k, "_", i)), get(paste0("acf_groundwaterdepth_", k, "_", i, "_", j))))
    }
    assign(paste0("acf_mean_groundwaterdepth_", k, "_", i), rowMeans(get(paste0("df_acf_groundwaterdepth_", k, "_", i))[, 2:11]))
  }
}
# -> Groundwaterdepth ist in allen Teildatensätzen positiv autokorreliert -> Modell, das diese Autokorrelation berücksichtigt, nötig

# ACF-Plots for groundwaterdepth (across all members) separated by each waterlevel and season
plot(x = 0:37, y = acf_mean_groundwaterdepth_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Grundwasserstands für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_groundwaterdepth_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Grundwasserstands für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_groundwaterdepth_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Grundwasserstands für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_groundwaterdepth_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Grundwasserstands für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_groundwaterdepth_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Grundwasserstands für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_groundwaterdepth_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. des Grundwasserstands für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

# partial autocorrelation function, mean pacf for groundwaterdepth (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_pacf_groundwaterdepth_", k, "_", i), data.frame(Names = 1:37))
    for (j in levels(hydro_total$member)) {
      assign(paste0("pacf_groundwaterdepth_", k, "_", i, "_", j),
             as.data.frame(pacf(get(paste0("hydro_", k, "_", i, "_", j))$groundwaterdepth, plot = FALSE)$acf))
      assign(paste0("df_pacf_groundwaterdepth_", k, "_", i),
             bind_cols(get(paste0("df_pacf_groundwaterdepth_", k, "_", i)), get(paste0("pacf_groundwaterdepth_", k, "_", i, "_", j))))
    }
    assign(paste0("pacf_mean_groundwaterdepth_", k, "_", i), rowMeans(get(paste0("df_pacf_groundwaterdepth_", k, "_", i))[, 2:11]))
  }
}
# 10304, Winter: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant
# 10304, Summer: Autokorrelationskoeffizient bis lag = 2 (durchgängig) signifikant
# 11502, Winter: Autokorrelationskoeffizient bis lag = 3 (durchgängig) signifikant
# 11502, Summer: Autokorrelationskoeffizient bis lag = 5 (durchgängig) signifikant
# 20203, Winter: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant
# 20203, Summer: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant

# PACF-Plots for groundwaterdepth (across all members) seperated by each waterlevel and season
plot(x = 1:37, y = pacf_mean_groundwaterdepth_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Grundwasserstands für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_groundwaterdepth_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Grundwasserstands für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_groundwaterdepth_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Grundwasserstands für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_groundwaterdepth_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Grundwasserstands für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_groundwaterdepth_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Grundwasserstands für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_groundwaterdepth_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. des Grundwasserstands für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")


## Infiltration
# autocorrelation function, mean acf for infiltration (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_acf_infiltration_", k, "_", i), data.frame(Names = 1:38))
    for (j in levels(hydro_total$member)) {
      assign(paste0("acf_infiltration_", k, "_", i, "_", j),
             as.data.frame(acf(get(paste0("hydro_", k, "_", i, "_", j))$infiltration, plot = FALSE)$acf))
      assign(paste0("df_acf_infiltration_", k, "_", i),
             bind_cols(get(paste0("df_acf_infiltration_", k, "_", i)), get(paste0("acf_infiltration_", k, "_", i, "_", j))))
    }
    assign(paste0("acf_mean_infiltration_", k, "_", i), rowMeans(get(paste0("df_acf_infiltration_", k, "_", i))[, 2:11]))
  }
}
# -> Infiltration ist in allen Teildatensätzen positiv autokorreliert -> Modell, das diese Autokorrelation berücksichtigt, nötig

# ACF-Plots for infiltration (across all members) separated by each waterlevel and season
plot(x = 0:37, y = acf_mean_infiltration_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der Wasserleitfähigkeit für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_infiltration_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der Wasserleitfähigkeit für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_infiltration_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der Wasserleitfähigkeit für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_infiltration_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der Wasserleitfähigkeit für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_infiltration_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der Wasserleitfähigkeit für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 0:37, y = acf_mean_infiltration_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "ACF", main = "Autokor. zw. Beob. der Wasserleitfähigkeit für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

# partial autocorrelation function, mean pacf for infiltration (across all members) separated by each waterlevel and season
for (k in c("winter", "summer")) {
  for (i in pegel_ids) {
    assign(paste0("df_pacf_infiltration_", k, "_", i), data.frame(Names = 1:37))
    for (j in levels(hydro_total$member)) {
      assign(paste0("pacf_infiltration_", k, "_", i, "_", j),
             as.data.frame(pacf(get(paste0("hydro_", k, "_", i, "_", j))$infiltration, plot = FALSE)$acf))
      assign(paste0("df_pacf_infiltration_", k, "_", i),
             bind_cols(get(paste0("df_pacf_infiltration_", k, "_", i)), get(paste0("pacf_infiltration_", k, "_", i, "_", j))))
    }
    assign(paste0("pacf_mean_infiltration_", k, "_", i), rowMeans(get(paste0("df_pacf_infiltration_", k, "_", i))[, 2:11]))
  }
}
# 10304, Winter: Autokorrelationskoeffizient bis lag = 6 (durchgängig) signifikant
# 10304, Summer: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant
# 11502, Winter: Autokorrelationskoeffizient bis lag = 3 (nicht durchgängig), bis lag = 1 (durchgängig) signifikant
# 11502, Summer: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant
# 20203, Winter: Autokorrelationskoeffizient bis lag = 2 (durchgängig) signifikant
# 20203, Summer: Autokorrelationskoeffizient bis lag = 1 (durchgängig) signifikant

# PACF-Plots for infiltration (across all members) seperated by each waterlevel and season
plot(x = 1:37, y = pacf_mean_infiltration_winter_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der Wasserleitfähigkeit für Isar Mittenwald, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_infiltration_summer_10304, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der Wasserleitfähigkeit für Isar Mittenwald, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_infiltration_winter_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der Wasserleitfähigkeit für Iller Kempten, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_infiltration_summer_11502, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der Wasserleitfähigkeit für Iller Kempten, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_infiltration_winter_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der Wasserleitfähigkeit für fränk. Saale Salz, Winter") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")
plot(x = 1:37, y = pacf_mean_infiltration_summer_20203, ylim = c(-0.1, 1), type = "h", xlab = "lag", ylab = "PACF", main = "Part. Autokor. zw. Beob. der Wasserleitfähigkeit für fränk. Saale Salz, Sommer") + abline(h = 0) + abline(h = c(-0.05, 0.05), col = "blue", lty = "dashed")

```


https://online.stat.psu.edu/stat501/book/export/html/996#:~:text=The%20order%20of%20an%20autoregression,written%20as%20AR(1)
# Lag DF
```{r}
lag_df <- function(dat, lag) {
  data.frame(unclass(dat[c(rep(NA, lag), 1:(nrow(dat)-lag)),]))
}

ggplot(aes(x = (lag(hydro_summer_10304_kbe$airtmp, 3)), y = hydro_summer_10304_kbe$drainage), data = hydro_summer_10304_kbe)+
  geom_point(alpha = 0.2)

ggplot(aes(x = (lag(hydro_summer_10304_kbe$soilwater, 2)), y = hydro_summer_10304_kbe$drainage), data = hydro_summer_10304_kbe)+
  geom_point(alpha = 0.2)

ggplot(aes(x = (lag(hydro_summer_10304_kbe$precip, 2)), y = hydro_summer_10304_kbe$drainage), data = hydro_summer_10304_kbe)+
  geom_point(alpha = 0.2)

ggplot(aes(x = (lag(hydro_summer_10304_kbe$avg_precip, 0)), y = hydro_summer_10304_kbe$drainage), data = hydro_summer_10304_kbe)+
  geom_point(alpha = 0.2)
```

# ARDLM
```{r}
ardlDlm_1 <- ardlDlm(formula = drainage ~ soilwater + precip + snowstorage + airtmp + glorad, data = hydro_summer_10304_kbe, p = 2, q = 2)

summary(ardlDlm_1)
```


```{r}

results_ardldlm_10304 <- list()
i <- 1
for (member in unique(hydro_summer_10304$member)){
  data <- hydro_summer_10304[hydro_summer_10304["member"] == member,]
  results_ardldlm_10304[i] <- ardlDlm(formula = drainage ~ soilwater + precip + snowstorage + airtmp, data = data, p = 3, q = 2)
  i <- i+ 1
}

lapply(results_ardldlm_10304, summary)

```
```{r}
results_ardldlm_11502 <- list()
i <- 1
for (member in unique(hydro_summer_10304$member)){
  data <- hydro_summer_11502[hydro_summer_11502["member"] == member,]
  results_ardldlm_11502[i] <- ardlDlm(formula = drainage ~ soilwater + precip + snowstorage + airtmp, data = data, p = 3, q = 2)
  i <- i+ 1
}

lapply(results_ardldlm_11502, summary)
```

```{r}
fit_ardlm_across <- function(formula, data, p, q, summary_output = TRUE) {
  results <- list()
i <- 1
for (member in unique(data$member)){
  data_loop <- data[data["member"] == member,]
  results[i] <- ardlDlm(formula = formula, data = data_loop, p = p, q = q)
  i <- i+ 1
}

lapply(results, summary)
}
```
# Summer
```{r}
fit_ardlm_across(drainage ~ soilwater + precip + snowstorage + airtmp, data = hydro_summer_10304, p = 3, q = 4)
fit_ardlm_across(drainage ~ soilwater + precip + snowstorage + airtmp, data = hydro_summer_11502, p = 3, q = 4)
fit_ardlm_across(drainage ~ soilwater + precip + snowstorage + airtmp + glorad, data = hydro_summer_20203, p = 3, q = 4)


lapply(fit_ardlm_across(drainage ~ soilwater + precip + snowstorage + airtmp, data = hydro_summer_20203, p = 2, q = 2), "[[", "adj.r.squared")
```
# Winter
```{r}
fit_ardlm_across(drainage ~ soilwater + precip + snowstorage + airtmp, data = hydro_winter_10304, p = 3, q = 2)
fit_ardlm_across(drainage ~ soilwater + precip + snowstorage + airtmp, data = hydro_winter_11502, p = 3, q = 2)
fit_ardlm_across(drainage ~ soilwater + precip + snowstorage + airtmp, data = hydro_winter_20203, p = 3, q = 2)
```

```{r}
rolCorPlot(ts_hydro_summer_10304_kbe)
```


## Lisa: Analysis

```{r Lisa analysis}
hydro_winter <- readRDS(file = "./data/hydro_winter.RDS")
hydro_summer <- readRDS(file = "./data/hydro_summer.RDS")
 
  
plot_cor_drainage <- function(data, var, ...) {
  ggplot(data, aes(x = get(var), y = drainage)) +
  geom_point(alpha = 0.1) +
  geom_smooth(method = "lm", col = "red") +
  labs(...)
}


# Airtmp
cor_airtmp <- numeric(length = 6)
plot_cor_drainage(data = hydro_winter_10304, var = "airtmp", x = "airtmp", title = "Winter 10304 (Isar Mittenwald) correlation airtmp and drainage")
cor_airtmp[1] <- cor(hydro_winter_10304$drainage, hydro_winter_10304$airtmp)
plot_cor_drainage(data = hydro_summer_10304, var = "airtmp", x = "airtmp", title = "Summer 10304 (Isar Mittenwald) correlation airtmp and drainage")
cor_airtmp[2] <- cor(hydro_summer_10304$drainage, hydro_summer_10304$airtmp)

plot_cor_drainage(data = hydro_winter_11502, var = "airtmp", x = "airtmp", title = "Winter 11502 (Iller Kempten) correlation airtmp and drainage")
cor_airtmp[3] <- cor(hydro_winter_11502$drainage, hydro_winter_11502$airtmp)
plot_cor_drainage(data = hydro_summer_11502, var = "airtmp", x = "airtmp", title = "Summer 11502 (Iller Kempten) correlation airtmp and drainage")
cor_airtmp[4] <- cor(hydro_summer_11502$drainage, hydro_summer_11502$airtmp)

plot_cor_drainage(data = hydro_winter_20203, var = "airtmp", x = "airtmp", title = "Winter 20203 (Fränkische Saale Salz) correlation airtmp and drainage")
cor_airtmp[5] <- cor(hydro_winter_20203$drainage, hydro_winter_20203$airtmp)
plot_cor_drainage(data = hydro_summer_20203, var = "airtmp", x = "airtmp", title = "Summer 20203 (Fränkische Saale Salz) correlation airtmp and drainage")
cor_airtmp[6] <- cor(hydro_summer_20203$drainage, hydro_summer_20203$airtmp)

var(cor_airtmp)

# Soilwater
cor_soilwater <- numeric(length = 6)
plot_cor_drainage(data = hydro_winter_10304, var = "soilwater", x = "soilwater", title = "Winter 10304 (Isar Mittenwald) correlation soilwater and drainage")
cor_soilwater[1] <- cor(hydro_winter_10304$drainage, hydro_winter_10304$soilwater)
plot_cor_drainage(data = hydro_summer_10304, var = "soilwater", x = "soilwater", title = "Summer 10304 (Isar Mittenwald) correlation soilwater and drainage")
cor_soilwater[2] <- cor(hydro_summer_10304$drainage, hydro_summer_10304$soilwater)

plot_cor_drainage(data = hydro_winter_11502, var = "soilwater", x = "soilwater", title = "Winter 11502 (Iller Kempten) correlation soilwater and drainage")
cor_soilwater[3] <- cor(hydro_winter_11502$drainage, hydro_winter_11502$soilwater)
plot_cor_drainage(data = hydro_summer_11502, var = "soilwater", x = "soilwater", title = "Summer 11502 (Iller Kempten) correlation soilwater and drainage")
cor_soilwater[4] <- cor(hydro_summer_11502$drainage, hydro_summer_11502$soilwater)

plot_cor_drainage(data = hydro_winter_20203, var = "soilwater", x = "soilwater", title = "Winter 20203 (Fränkische Saale Salz) correlation soilwater and drainage")
cor_soilwater[5] <- cor(hydro_winter_20203$drainage, hydro_winter_20203$soilwater)
plot_cor_drainage(data = hydro_summer_20203, var = "soilwater", x = "soilwater", title = "Summer 20203 (Fränkische Saale Salz) correlation soilwater and drainage")
cor_soilwater[6] <- cor(hydro_summer_20203$drainage, hydro_summer_20203$soilwater)

var(cor_soilwater)


# Precip
cor_precip <- numeric(length = 6)
plot_cor_drainage(data = hydro_winter_10304, var = "precip", x = "precip", title = "Winter 10304 (Isar Mittenwald) correlation precip and drainage")
cor_precip[1] <- cor(hydro_winter_10304$drainage, hydro_winter_10304$precip)
plot_cor_drainage(data = hydro_summer_10304, var = "precip", x = "precip", title = "Summer 10304 (Isar Mittenwald) correlation precip and drainage")
cor_precip[2] <- cor(hydro_summer_10304$drainage, hydro_summer_10304$precip)

plot_cor_drainage(data = hydro_winter_11502, var = "precip", x = "precip", title = "Winter 11502 (Iller Kempten) correlation precip and drainage")
cor_precip[3] <- cor(hydro_winter_11502$drainage, hydro_winter_11502$precip)
plot_cor_drainage(data = hydro_summer_11502, var = "precip", x = "precip", title = "Summer 11502 (Iller Kempten) correlation precip and drainage")
cor_precip[4] <- cor(hydro_summer_11502$drainage, hydro_summer_11502$precip)

plot_cor_drainage(data = hydro_winter_20203, var = "precip", x = "precip", title = "Winter 20203 (Fränkische Saale Salz) correlation precip and drainage")
cor_precip[5] <- cor(hydro_winter_20203$drainage, hydro_winter_20203$precip)
plot_cor_drainage(data = hydro_summer_20203, var = "precip", x = "precip", title = "Summer 20203 (Fränkische Saale Salz) correlation precip and drainage")
cor_precip[6] <- cor(hydro_summer_20203$drainage, hydro_summer_20203$precip)

var(cor_precip)

# not differentiated by waterlevels
library(corrplot)

## winter

# not differentiated by waterlevels
correlationm_spearman_winter <- cor(subset(hydro_winter, select = c(drainage, airtmp, soilwater, precip, glorad, relhum, snowstorage, groundwaterdepth, infiltration)), method = "spearman")
correlationp_spearman_winter <- cor.mtest(correlationm_spearman_winter)
# -> correlation drainage with soilwater and with groundwaterdepth significant at level = 0.05
corrplot.mixed(correlationm_spearman_winter, upper = "circle", lower = "number", lower.col = "black")
corrplot.mixed(correlationm_spearman_winter, upper = "circle", lower = "number", lower.col = "black", p.mat = correlationp_spearman_winter$p)

# 10304
correlationm_spearman_winter_10304 <- cor(subset(hydro_winter_10304, select = c(drainage, airtmp, soilwater, precip, glorad, relhum, snowstorage, groundwaterdepth, infiltration)), method = "spearman")
correlationp_spearman_winter_10304 <- cor.mtest(correlationm_spearman_winter_10304)
# correlation drainage with airtmp, with soilwater and with infiltration significant at level = 0.05
corrplot.mixed(correlationm_spearman_winter_10304, upper = "circle", lower = "number", lower.col = "black")
corrplot.mixed(correlationm_spearman_winter_10304, upper = "circle", lower = "number", lower.col = "black", p.mat = correlationp_spearman_winter_10304$p)

# 11502
correlationm_spearman_winter_11502 <- cor(subset(hydro_winter_11502, select = c(drainage, airtmp, soilwater, precip, glorad, relhum, snowstorage, groundwaterdepth, infiltration)), method = "spearman")
correlationp_spearman_winter_11502 <- cor.mtest(correlationm_spearman_winter_11502)
# correlation drainage with soilwater significant at level = 0.05
corrplot.mixed(correlationm_spearman_winter_11502, upper = "circle", lower = "number", lower.col = "black")
corrplot.mixed(correlationm_spearman_winter_11502, upper = "circle", lower = "number", lower.col = "black", p.mat = correlationp_spearman_winter_11502$p)

# 20203
correlationm_spearman_winter_20203 <- cor(subset(hydro_winter_20203, select = c(drainage, airtmp, soilwater, precip, glorad, relhum, snowstorage, groundwaterdepth, infiltration)), method = "spearman")
correlationp_spearman_winter_20203 <- cor.mtest(correlationm_spearman_winter_20203)
# correlation drainage with soilwater significant at level = 0.05
corrplot.mixed(correlationm_spearman_winter_20203, upper = "circle", lower = "number", lower.col = "black")
corrplot.mixed(correlationm_spearman_winter_20203, upper = "circle", lower = "number", lower.col = "black", p.mat = correlationp_spearman_winter_20203$p)


## summer

# not differentiated by waterlevels
correlationm_spearman_summer <- cor(subset(hydro_summer, select = c(drainage, airtmp, soilwater, precip, glorad, relhum, snowstorage, groundwaterdepth, infiltration)), method = "spearman")
correlationp_spearman_summer <- cor.mtest(correlationm_spearman_summer)
# correlation drainage with airtmp, soilwater and snowstorage significant at level = 0.05
corrplot.mixed(correlationm_spearman_summer, upper = "circle", lower = "number", lower.col = "black")
corrplot.mixed(correlationm_spearman_summer, upper = "circle", lower = "number", lower.col = "black", p.mat = correlationp_spearman_summer$p)

# 10304
correlationm_spearman_summer_10304 <- cor(subset(hydro_summer_10304, select = c(drainage, airtmp, soilwater, precip, glorad, relhum, snowstorage, groundwaterdepth, infiltration)), method = "spearman")
correlationp_spearman_summer_10304 <- cor.mtest(correlationm_spearman_summer_10304)
# correlation drainage with soilwater and snowstorage significant at level = 0.05
corrplot.mixed(correlationm_spearman_summer_10304, upper = "circle", lower = "number", lower.col = "black")
corrplot.mixed(correlationm_spearman_summer_10304, upper = "circle", lower = "number", lower.col = "black", p.mat = correlationp_spearman_summer_10304$p)

# 11502
correlationm_spearman_summer_11502 <- cor(subset(hydro_summer_11502, select = c(drainage, airtmp, soilwater, precip, glorad, relhum, snowstorage, groundwaterdepth, infiltration)), method = "spearman")
correlationp_spearman_summer_11502 <- cor.mtest(correlationm_spearman_summer_11502)
# correlation drainage with soilwater and snowstorage significant at level = 0.05
corrplot.mixed(correlationm_spearman_summer_11502, upper = "circle", lower = "number", lower.col = "black")
corrplot.mixed(correlationm_spearman_summer_11502, upper = "circle", lower = "number", lower.col = "black", p.mat = correlationp_spearman_summer_11502$p)

# 20203
correlationm_spearman_summer_20203 <- cor(subset(hydro_summer_20203, select = c(drainage, airtmp, soilwater, precip, glorad, relhum, snowstorage, groundwaterdepth, infiltration)), method = "spearman")
correlationp_spearman_summer_20203 <- cor.mtest(correlationm_spearman_summer_20203)
# correlation drainage with soilwater significant at level = 0.05
corrplot.mixed(correlationm_spearman_summer_20203, upper = "circle", lower = "number", lower.col = "black")
corrplot.mixed(correlationm_spearman_summer_20203, upper = "circle", lower = "number", lower.col = "black", p.mat = correlationp_spearman_summer_20203$p)


# plots drainage and drivers over time
plot_single_drainage_and_driver <- function(dataset, var, per_year = TRUE, years = 1990:2020, member_input = "kbe") {
  data <- dataset %>% filter(member == member_input, YY %in% years) %>% group_by(YY)
  if (per_year == TRUE) {
    data <- data %>% summarise(avg_drainage = mean(drainage), avg_var = mean(get(var)))
    plot <- data %>% ggplot() +
      geom_line(mapping = aes(x = YY, y = avg_drainage), col = "blue") +
      geom_point(aes(x = YY, y = avg_drainage), col = "blue") +
      geom_point(aes(x = YY, y = avg_var), col = "red") +
      geom_line(aes(x = YY, y = avg_var), col = "red") +
      scale_y_continuous("drainage in blue", sec.axis = sec_axis(trans = ~., name = paste(as.character(var), "in red")))
  } else {
    plot <- data %>% ggplot() +
      geom_line(mapping = aes(x = date, y = drainage), col = "blue") +
      geom_point(aes(x = date, y = drainage), col = "blue") +
      geom_point(aes(x = date, y = get(var)), col = "red") +
      geom_line(aes(x = date, y = get(var)), col = "red") +
      scale_y_continuous("drainage in blue", sec.axis = sec_axis(trans = ~., name = paste(as.character(var), "in red")))
  }
  plot
}

plot_single_drainage_and_driver(hydro_total %>% filter(name_waterlevel == 10304), var = "avg_airtmp", year = 2000:2003, per_year = FALSE)
```
## Jonas: Analysis

```{r Jonas analysis}
```

###### Basic linear models (might not be appropriate)
### ZV: Drainage

## Temp
``` {r}
# Summer
summary(lm(hydro_summer_10304$airtmp ~ hydro_summer_10304$drainage))
summer_temp_10304 <- ggplot(hydro_summer_10304, aes(airtmp, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_11502$airtmp ~ hydro_summer_11502$drainage))
summer_temp_11502 <- ggplot(hydro_summer_11502, aes(airtmp, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_20203$airtmp ~ hydro_summer_20203$drainage))
summer_temp_20203 <- ggplot(hydro_summer_20203, aes(airtmp, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(summer_temp_10304, summer_temp_11502, summer_temp_20203, ncol = 2)


## Nach membern differenziert ein Testplot
ggplot(data = hydro_summer_10304, aes(x = airtmp, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()

# Winter
summary(lm(hydro_winter_10304$airtmp ~ hydro_winter_10304$drainage))
winter_temp_10304 <- ggplot(hydro_winter_10304, aes(airtmp, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_11502$airtmp ~ hydro_winter_11502$drainage))
winter_temp_11502 <- ggplot(hydro_winter_11502, aes(airtmp, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_20203$airtmp ~ hydro_winter_20203$drainage))
winter_temp_20203 <- ggplot(hydro_winter_20203, aes(airtmp, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(winter_temp_10304, winter_temp_11502, winter_temp_20203, ncol = 2)
grid.arrange(winter_temp_10304, winter_temp_11502, winter_temp_20203, 
             summer_temp_10304, summer_temp_11502, summer_temp_20203,ncol = 2)

## Nach membern differenziert ein Testplot
ggplot(data = hydro_winter_10304, aes(x = airtmp, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()
```

## precip
```{r}
summary(lm(hydro_summer_10304$precip ~ hydro_summer_10304$drainage))
summer_precip_10304 <- ggplot(hydro_summer_10304, aes(precip, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_11502$precip ~ hydro_summer_11502$drainage))
summer_precip_11502 <- ggplot(hydro_summer_11502, aes(precip, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_20203$precip ~ hydro_summer_20203$drainage))
summer_precip_20203 <- ggplot(hydro_summer_20203, aes(precip, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(summer_precip_10304, summer_precip_11502, summer_precip_20203, ncol = 2)
## Nach membern differenziert ein Testplot
ggplot(data = hydro_summer_10304, aes(x = precip, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()
# Winter
summary(lm(hydro_winter_10304$precip ~ hydro_winter_10304$drainage))
winter_precip_10304 <- ggplot(hydro_winter_10304, aes(precip, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_11502$precip ~ hydro_winter_11502$drainage))
winter_precip_11502 <- ggplot(hydro_winter_11502, aes(precip, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_20203$precip ~ hydro_winter_20203$drainage))
winter_precip_20203 <- ggplot(hydro_winter_20203, aes(precip, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(winter_precip_10304, winter_precip_11502, winter_precip_20203, ncol = 2)
grid.arrange(winter_precip_10304, winter_precip_11502, winter_precip_20203, 
             summer_precip_10304, summer_precip_11502, summer_precip_20203, ncol = 3)
## Nach membern differenziert ein Testplot
ggplot(data = hydro_winter_10304, aes(x = precip, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()
```

## radiation
```{r}
summary(lm(hydro_summer_10304$glorad ~ hydro_summer_10304$drainage))
summer_glorad_10304 <- ggplot(hydro_summer_10304, aes(glorad, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_11502$glorad ~ hydro_summer_11502$drainage))
summer_glorad_11502 <- ggplot(hydro_summer_11502, aes(glorad, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_20203$glorad ~ hydro_summer_20203$drainage))
summer_glorad_20203 <- ggplot(hydro_summer_20203, aes(glorad, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(summer_glorad_10304, summer_glorad_11502, summer_glorad_20203, ncol = 2)

## Nach membern differenziert ein Testplot
ggplot(data = hydro_summer_10304, aes(x = glorad, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()
# Winter
summary(lm(hydro_winter_10304$glorad ~ hydro_winter_10304$drainage))
winter_glorad_10304 <- ggplot(hydro_winter_10304, aes(glorad, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_11502$glorad ~ hydro_winter_11502$drainage))
winter_glorad_11502 <- ggplot(hydro_winter_11502, aes(glorad, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_20203$glorad ~ hydro_winter_20203$drainage))
winter_glorad_20203 <- ggplot(hydro_winter_20203, aes(glorad, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(winter_glorad_10304, winter_glorad_11502, winter_glorad_20203, ncol = 2)
grid.arrange(winter_glorad_10304, winter_glorad_11502, winter_glorad_20203, 
             summer_glorad_10304, summer_glorad_11502, summer_glorad_20203, ncol = 3)

## Nach membern differenziert ein Testplot
ggplot(data = hydro_winter_10304, aes(x = glorad, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()
```

# rel. Humidity
``` {r}
summary(lm(hydro_summer_10304$relhum ~ hydro_summer_10304$drainage))
summer_relhum_10304 <- ggplot(hydro_summer_10304, aes(relhum, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_11502$relhum ~ hydro_summer_11502$drainage))
summer_relhum_11502 <- ggplot(hydro_summer_11502, aes(relhum, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_20203$relhum ~ hydro_summer_20203$drainage))
summer_relhum_20203 <- ggplot(hydro_summer_20203, aes(relhum, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(summer_relhum_10304, summer_relhum_11502, summer_relhum_20203, ncol = 2)

## Nach membern differenziert ein Testplot
ggplot(data = hydro_summer_10304, aes(x = relhum, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()
# Winter
summary(lm(hydro_winter_10304$relhum ~ hydro_winter_10304$drainage))
winter_relhum_10304 <- ggplot(hydro_winter_10304, aes(relhum, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_11502$relhum ~ hydro_winter_11502$drainage))
winter_relhum_11502 <- ggplot(hydro_winter_11502, aes(relhum, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_20203$relhum ~ hydro_winter_20203$drainage))
winter_relhum_20203 <- ggplot(hydro_winter_20203, aes(relhum, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(winter_relhum_10304, winter_relhum_11502, winter_relhum_20203, ncol = 2)
grid.arrange(winter_relhum_10304, winter_relhum_11502, winter_relhum_20203, 
             summer_relhum_10304, summer_relhum_11502, summer_relhum_20203, ncol = 3)

## Nach membern differenziert ein Testplot
ggplot(data = hydro_winter_10304, aes(x = relhum, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()



```

# Groundwater depth
``` {r}
summary(lm(hydro_summer_10304$groundwaterdepth ~ hydro_summer_10304$drainage))
summer_groundwaterdepth_10304 <- ggplot(hydro_summer_10304, aes(groundwaterdepth, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_11502$groundwaterdepth ~ hydro_summer_11502$drainage))
summer_groundwaterdepth_11502 <- ggplot(hydro_summer_11502, aes(groundwaterdepth, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_20203$groundwaterdepth ~ hydro_summer_20203$drainage))
summer_groundwaterdepth_20203 <- ggplot(hydro_summer_20203, aes(groundwaterdepth, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(summer_groundwaterdepth_10304, summer_groundwaterdepth_11502, summer_groundwaterdepth_20203, ncol = 2)

## Nach membern differenziert ein Testplot
ggplot(data = hydro_summer_10304, aes(x = groundwaterdepth, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()

# Winter
summary(lm(hydro_winter_10304$groundwaterdepth ~ hydro_winter_10304$drainage))
winter_groundwaterdepth_10304 <- ggplot(hydro_winter_10304, aes(groundwaterdepth, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_11502$groundwaterdepth ~ hydro_winter_11502$drainage))
winter_groundwaterdepth_11502 <- ggplot(hydro_winter_11502, aes(groundwaterdepth, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_20203$groundwaterdepth ~ hydro_winter_20203$drainage))
winter_groundwaterdepth_20203 <- ggplot(hydro_winter_20203, aes(groundwaterdepth, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(winter_groundwaterdepth_10304, winter_groundwaterdepth_11502, winter_groundwaterdepth_20203, ncol = 2)
grid.arrange(winter_groundwaterdepth_10304, winter_groundwaterdepth_11502, winter_groundwaterdepth_20203, 
             summer_groundwaterdepth_10304, summer_groundwaterdepth_11502, summer_groundwaterdepth_20203, ncol = 3)

## Nach membern differenziert ein Testplot
ggplot(data = hydro_winter_10304, aes(x = groundwaterdepth, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()
```

# Soilwater
``` {r}
summary(lm(hydro_summer_10304$soilwater ~ hydro_summer_10304$drainage))
summer_soilwater_10304 <- ggplot(hydro_summer_10304, aes(soilwater, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_11502$soilwater ~ hydro_summer_11502$drainage))
summer_soilwater_11502 <- ggplot(hydro_summer_11502, aes(soilwater, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_20203$soilwater ~ hydro_summer_20203$drainage))
summer_soilwater_20203 <- ggplot(hydro_summer_20203, aes(soilwater, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(summer_soilwater_10304, summer_soilwater_11502, summer_soilwater_20203, ncol = 2)

## Nach membern differenziert ein Testplot
ggplot(data = hydro_summer_10304, aes(x = soilwater, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()

# Winter
summary(lm(hydro_winter_10304$soilwater ~ hydro_winter_10304$drainage))
winter_soilwater_10304 <- ggplot(hydro_winter_10304, aes(soilwater, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_11502$soilwater ~ hydro_winter_11502$drainage))
winter_soilwater_11502 <- ggplot(hydro_winter_11502, aes(soilwater, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_20203$soilwater ~ hydro_winter_20203$drainage))
winter_soilwater_20203 <- ggplot(hydro_winter_20203, aes(soilwater, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(winter_soilwater_10304, winter_soilwater_11502, winter_soilwater_20203, ncol = 2)
grid.arrange(winter_soilwater_10304, winter_soilwater_11502, winter_soilwater_20203, 
             summer_soilwater_10304, summer_soilwater_11502, summer_soilwater_20203, ncol = 3)

## Nach membern differenziert ein Testplot
ggplot(data = hydro_winter_10304, aes(x = soilwater, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()
```

# snow
``` {r}
summary(lm(hydro_summer_10304$snowstorage ~ hydro_summer_10304$drainage))
summer_snowstorage_10304 <-  ggplot(hydro_summer_10304, aes(snowstorage, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_11502$snowstorage ~ hydro_summer_11502$drainage))
summer_snowstorage_11502 <- ggplot(hydro_summer_11502, aes(snowstorage, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_summer_20203$snowstorage ~ hydro_summer_20203$drainage))
summer_snowstorage_20203 <- ggplot(hydro_summer_20203, aes(snowstorage, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(summer_snowstorage_10304, summer_snowstorage_11502, summer_snowstorage_20203, ncol = 2)

## Nach membern differenziert ein Testplot
ggplot(data = hydro_summer_10304, aes(x = snowstorage, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()

# Winter
summary(lm(hydro_winter_10304$snowstorage ~ hydro_winter_10304$drainage))
winter_snowstorage_10304 <- ggplot(hydro_winter_10304, aes(snowstorage, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_11502$snowstorage ~ hydro_winter_11502$drainage))
winter_snowstorage_11502 <- ggplot(hydro_winter_11502, aes(snowstorage, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
summary(lm(hydro_winter_20203$snowstorage ~ hydro_winter_20203$drainage))
winter_snowstorage_20203 <- ggplot(hydro_winter_20203, aes(snowstorage, drainage)) +
  geom_point() +
  geom_smooth(method = "lm", formular = y~x)
grid.arrange(winter_snowstorage_10304, winter_snowstorage_11502, winter_snowstorage_20203, ncol = 2)
grid.arrange(winter_snowstorage_10304, winter_snowstorage_11502, winter_snowstorage_20203, 
             summer_snowstorage_10304, summer_snowstorage_11502, summer_snowstorage_20203, ncol = 3)

## Nach membern differenziert ein Testplot
ggplot(data = hydro_winter_10304, aes(x = snowstorage, y = drainage, color = member)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw()

```


### ZV: LowLevel

##temp
``` {r}
# summer

y <- hydro_summer_10304$lowlevel
x <- hydro_summer_10304$airtmp
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_10304_tmp <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TURE) +
                            labs(title = "Summer 10304", x = "Temp", y = "LowLevel")
event_summer_10304_tmp0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "tmp", y = "Low Level")
event_summer_10304_tmp1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "tmp", y = "Low Level")
grid_event_summer_10304_tmp <- grid.arrange(event_summer_10304_tmp, event_summer_10304_tmp0, event_summer_10304_tmp1, ncol = 1)


y <- hydro_summer_11502$lowlevel
x <- hydro_summer_11502$airtmp
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_11502_tmp <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 11502", x = "Temp", y = "LowLevel")
event_summer_11502_tmp0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "tmp", y = "Low Level")
event_summer_11502_tmp1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "tmp", y = "Low Level")
grid_event_summer_11502_tmp <- grid.arrange(event_summer_11502_tmp, event_summer_11502_tmp0, event_summer_11502_tmp1, ncol = 1)


y <- hydro_summer_20203$lowlevel
x <- hydro_summer_20203$airtmp
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_20203_tmp <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 20203", x = "Temp", y = "LowLevel")
event_summer_20203_tmp0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "tmp", y = "Low Level")
event_summer_20203_tmp1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "tmp", y = "Low Level")
grid_event_summer_20203_tmp <- grid.arrange(event_summer_20203_tmp, event_summer_20203_tmp0, event_summer_20203_tmp1, ncol = 1)

grid.arrange(grid_event_summer_10304_tmp, grid_event_summer_11502_tmp, grid_event_summer_20203_tmp, ncol = 2)

# winter
y <- hydro_winter_10304$lowlevel
x <- hydro_winter_10304$airtmp
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_10304_tmp <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 10304", x = "Temp", y = "LowLevel")
event_winter_10304_tmp0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "tmp", y = "Low Level")
event_winter_10304_tmp1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "tmp", y = "Low Level")
grid_event_winter_10304_tmp <- grid.arrange(event_winter_10304_tmp, event_winter_10304_tmp0, event_winter_10304_tmp1, ncol = 1)


y <- hydro_winter_11502$lowlevel
x <- hydro_winter_11502$airtmp
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_11502_tmp <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 11502", x = "Temp", y = "LowLevel")
event_winter_11502_tmp0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "tmp", y = "Low Level")
event_winter_11502_tmp1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "tmp", y = "Low Level")
grid_event_winter_11502_tmp <- grid.arrange(event_winter_11502_tmp, event_winter_11502_tmp0, event_winter_11502_tmp1, ncol = 1)


y <- hydro_winter_20203$lowlevel
x <- hydro_winter_20203$airtmp
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_20203_tmp <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 20203", x = "Temp", y = "LowLevel")
event_winter_20203_tmp0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "tmp", y = "Low Level")
event_winter_20203_tmp1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "tmp", y = "Low Level")
grid_event_winter_20203_tmp <- grid.arrange(event_winter_20203_tmp, event_winter_20203_tmp0, event_winter_20203_tmp1, ncol = 1)

grid.arrange(grid_event_summer_10304_tmp, grid_event_summer_11502_tmp, grid_event_summer_20203_tmp, ncol = 2)
grid.arrange(grid_event_summer_10304_tmp, grid_event_summer_11502_tmp, grid_event_summer_20203_tmp, grid_event_summer_10304_tmp, grid_event_summer_11502_tmp, grid_event_summer_20203_tmp, ncol = 3)

```

##precip
``` {r}
# summer

y <- hydro_summer_10304$lowlevel
x <- hydro_summer_10304$precip
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_10304_precip <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 10304", x = "precip", y = "LowLevel")
event_summer_10304_precip0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "tmp", y = "Low Level")
event_summer_10304_precip1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "tmp", y = "Low Level")
grid_event_summer_10304_precip <- grid.arrange(event_summer_10304_precip, event_summer_10304_precip0, event_summer_10304_precip1, ncol = 1)



y <- hydro_summer_11502$lowlevel
x <- hydro_summer_11502$precip
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_11502_precip <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 11502", x = "precip", y = "LowLevel")
event_summer_11502_precip0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "tmp", y = "Low Level")
event_summer_11502_precip1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "tmp", y = "Low Level")
grid_event_summer_11502_precip <- grid.arrange(event_summer_11502_precip, event_summer_11502_precip0, event_summer_11502_precip1, ncol = 1)



y <- hydro_summer_20203$lowlevel
x <- hydro_summer_20203$precip
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_20203_precip <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 20203", x = "precip", y = "LowLevel")
event_summer_20203_precip0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "tmp", y = "Low Level")
event_summer_20203_precip1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "tmp", y = "Low Level")
grid_event_summer_20203_precip <- grid.arrange(event_summer_20203_precip, event_summer_20203_precip0, event_summer_20203_precip1, ncol = 1)
grid.arrange(grid_event_summer_10304_precip, grid_event_summer_11502_precip, grid_event_summer_20203_precip, ncol = 2)

# winter
y <- hydro_winter_10304$lowlevel
x <- hydro_winter_10304$precip
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_10304_precip <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 10304", x = "precip", y = "LowLevel")
event_winter_10304_precip0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "tmp", y = "Low Level")
event_winter_10304_precip1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "tmp", y = "Low Level")
grid_event_winter_10304_precip <- grid.arrange(event_winter_10304_precip, event_winter_10304_precip0, event_winter_10304_precip1, ncol = 1)


y <- hydro_winter_11502$lowlevel
x <- hydro_winter_11502$precip
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_11502_precip <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 11502", x = "precip", y = "LowLevel")
event_winter_11502_precip0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "tmp", y = "Low Level")
event_winter_11502_precip1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "tmp", y = "Low Level")
grid_event_winter_11502_precip <- grid.arrange(event_winter_11502_precip, event_winter_11502_precip0, event_winter_11502_precip1, ncol = 1)


y <- hydro_winter_20203$lowlevel
x <- hydro_winter_20203$precip
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_20203_precip <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 20203", x = "precip", y = "LowLevel")
event_winter_20203_precip0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "tmp", y = "Low Level")
event_winter_20203_precip1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "tmp", y = "Low Level")
grid_event_winter_20203_precip <- grid.arrange(event_winter_20203_precip, event_winter_20203_precip0, event_winter_20203_precip1, ncol = 1)
grid.arrange(grid_event_winter_10304_precip, grid_event_winter_11502_precip, grid_event_winter_20203_precip, ncol = 2)
grid.arrange(grid_event_summer_10304_precip, grid_event_summer_11502_precip, grid_event_summer_20203_precip, grid_event_winter_10304_precip, grid_event_winter_11502_precip, grid_event_winter_20203_precip, ncol = 3)

```

## radiation
``` {r}
# summer

y <- hydro_summer_10304$lowlevel
x <- hydro_summer_10304$glorad
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_10304_glorad<- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 10304", x = "glorad", y = "LowLevel")
event_summer_10304_glorad0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "glorad", y = "Low Level")
event_summer_10304_glorad1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "glorad", y = "Low Level")
grid_event_summer_10304_glorad <- grid.arrange(event_summer_10304_glorad, event_summer_10304_glorad0, event_summer_10304_glorad1, ncol = 1)


y <- hydro_summer_11502$lowlevel
x <- hydro_summer_11502$glorad
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_11502_glorad <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 11502", x = "glorad", y = "LowLevel")
event_summer_11502_glorad0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "glorad", y = "Low Level")
event_summer_11502_glorad1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "glorad", y = "Low Level")
grid_event_summer_11502_glorad <- grid.arrange(event_summer_11502_glorad, event_summer_11502_glorad0, event_summer_11502_glorad1, ncol = 1)


y <- hydro_summer_20203$lowlevel
x <- hydro_summer_20203$glorad
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_20203_glorad <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 20203", x = "glorad", y = "LowLevel")
event_summer_20203_glorad0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "glorad", y = "Low Level")
event_summer_20203_glorad1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "glorad", y = "Low Level")
grid_event_summer_20203_glorad <- grid.arrange(event_summer_20203_glorad, event_summer_20203_glorad0, event_summer_20203_glorad1, ncol = 1)

grid.arrange(grid_event_summer_10304_glorad, grid_event_summer_11502_glorad, grid_event_summer_20203_glorad, ncol = 2)

# winter
y <- hydro_winter_10304$lowlevel
x <- hydro_winter_10304$glorad
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_10304_glorad <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 10304", x = "glorad", y = "LowLevel")
event_winter_10304_glorad0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "glorad", y = "Low Level")
event_winter_10304_glorad1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "glorad", y = "Low Level")
grid_event_winter_10304_glorad <- grid.arrange(event_winter_10304_glorad, event_winter_10304_glorad0, event_winter_10304_glorad1, ncol = 1)                           


y <- hydro_winter_11502$lowlevel
x <- hydro_winter_11502$glorad
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_11502_glorad <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 11502", x = "glorad", y = "LowLevel")
event_winter_11502_glorad0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "glorad", y = "Low Level")
event_winter_11502_glorad1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "glorad", y = "Low Level")
grid_event_winter_11502_glorad <- grid.arrange(event_winter_11502_glorad, event_winter_11502_glorad0, event_winter_11502_glorad1, ncol = 1)


y <- hydro_winter_20203$lowlevel
x <- hydro_winter_20203$glorad
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_20203_glorad <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 20203", x = "glorad", y = "LowLevel")
event_winter_20203_glorad0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "glorad", y = "Low Level")
event_winter_20203_glorad1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "glorad", y = "Low Level")
grid_event_winter_20203_glorad <- grid.arrange(event_winter_20203_glorad, event_winter_20203_glorad0, event_winter_20203_glorad1, ncol = 1)
grid.arrange(grid_event_winter_10304_glorad, grid_event_winter_11502_glorad, grid_event_winter_20203_glorad, ncol = 2)
grid.arrange(grid_event_summer_10304_glorad, grid_event_summer_11502_glorad, grid_event_summer_20203_glorad, grid_event_winter_10304_glorad, grid_event_winter_11502_glorad, grid_event_winter_20203_glorad, ncol = 3)

```

## rel.humidity
``` {r}
# summer

y <- hydro_summer_10304$lowlevel
x <- hydro_summer_10304$relhum
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_10304_relhum <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 10304", x = "relhum", y = "LowLevel")
event_summer_10304_relhum0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "relhum", y = "Low Level")
event_summer_10304_relhum1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "relhum", y = "Low Level")
grid_event_summer_10304_relhum <- grid.arrange(event_summer_10304_relhum, event_summer_10304_relhum0, event_summer_10304_relhum1, ncol = 1)

y <- hydro_summer_11502$lowlevel
x <- hydro_summer_11502$relhum
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_11502_relhum <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 11502", x = "relhum", y = "LowLevel")
event_summer_11502_relhum0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "relhum", y = "Low Level")
event_summer_11502_relhum1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "relhum", y = "Low Level")
grid_event_summer_11502_relhum <- grid.arrange(event_summer_11502_relhum, event_summer_11502_relhum0, event_summer_11502_relhum1, ncol = 1)


y <- hydro_summer_20203$lowlevel
x <- hydro_summer_20203$relhum
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_20203_relhum <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 20203", x = "relhum", y = "LowLevel")
event_summer_20203_relhum0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "relhum", y = "Low Level")
event_summer_20203_relhum1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "relhum", y = "Low Level")
grid_event_summer_20203_relhum <- grid.arrange(event_summer_20203_relhum, event_summer_20203_relhum0, event_summer_20203_relhum1, ncol = 1)

grid.arrange(grid_event_summer_10304_relhum, grid_event_summer_11502_relhum, grid_event_summer_20203_relhum, ncol = 2)

# winter
y <- hydro_winter_10304$lowlevel
x <- hydro_winter_10304$relhum
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_10304_relhum <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 10304", x = "relhum", y = "LowLevel")
event_winter_10304_relhum0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "relhum", y = "Low Level")
event_winter_10304_relhum1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "relhum", y = "Low Level")
grid_event_winter_10304_relhum <- grid.arrange(event_winter_10304_relhum, event_winter_10304_relhum0, event_winter_10304_relhum1, ncol = 1)       

y <- hydro_winter_11502$lowlevel
x <- hydro_winter_11502$relhum
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_11502_relhum <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 11502", x = "relhum", y = "LowLevel")
event_winter_11502_relhum0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "relhum", y = "Low Level")
event_winter_11502_relhum1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "relhum", y = "Low Level")
grid_event_winter_11502_relhum <- grid.arrange(event_winter_11502_relhum, event_winter_11502_relhum0, event_winter_11502_relhum1, ncol = 1)


y <- hydro_winter_20203$lowlevel
x <- hydro_winter_20203$relhum
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_20203_relhum <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 20203", x = "relhum", y = "LowLevel")
event_winter_20203_relhum0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "relhum", y = "Low Level")
event_winter_20203_relhum1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "relhum", y = "Low Level")
grid_event_winter_20203_relhum <- grid.arrange(event_winter_20203_relhum, event_winter_20203_relhum0, event_winter_20203_relhum1, ncol = 1)

grid.arrange(grid_event_winter_10304_relhum, grid_event_winter_11502_relhum, grid_event_winter_20203_relhum, ncol = 2)
grid.arrange(grid_event_summer_10304_relhum, grid_event_summer_11502_relhum, grid_event_summer_20203_relhum, grid_event_winter_10304_relhum, grid_event_winter_11502_relhum, grid_event_winter_20203_relhum, ncol = 3)


```

## groundwater depth
``` {r}
# summer

y <- hydro_summer_10304$lowlevel
x <- hydro_summer_10304$groundwaterdepth
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_10304_groundwaterdepth <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 10304", x = "groundwaterdepth", y = "LowLevel")
event_summer_10304_groundwaterdepth0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "groundwaterdepth", y = "Low Level")
event_summer_10304_groundwaterdepth1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "groundwaterdepth", y = "Low Level")
grid_event_summer_10304_groundwaterdepth <- grid.arrange(event_summer_10304_groundwaterdepth, event_summer_10304_groundwaterdepth0, event_summer_10304_groundwaterdepth1, ncol = 1)



y <- hydro_summer_11502$lowlevel
x <- hydro_summer_11502$groundwaterdepth
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_11502_groundwaterdepth <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 11502", x = "groundwaterdepth", y = "LowLevel")
event_summer_11502_groundwaterdepth0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "groundwaterdepth", y = "Low Level")
event_summer_11502_groundwaterdepth1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "groundwaterdepth", y = "Low Level")
grid_event_summer_11502_groundwaterdepth<- grid.arrange(event_summer_11502_groundwaterdepth, event_summer_11502_groundwaterdepth0, event_summer_11502_groundwaterdepth1, ncol = 1)



y <- hydro_summer_20203$lowlevel
x <- hydro_summer_20203$groundwaterdepth
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_20203_groundwaterdepth <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 20203", x = "groundwaterdepth", y = "LowLevel")
event_summer_20203_groundwaterdepth0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "groundwaterdepth", y = "Low Level")
event_summer_20203_groundwaterdepth1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "groundwaterdepth", y = "Low Level")
grid_event_summer_20203_groundwaterdepth <- grid.arrange(event_summer_20203_groundwaterdepth, event_summer_20203_groundwaterdepth0, event_summer_20203_groundwaterdepth1, ncol = 1)

grid.arrange(grid_event_summer_10304_groundwaterdepth, grid_event_summer_11502_groundwaterdepth, grid_event_summer_20203_groundwaterdepth, ncol = 2)

# winter
y <- hydro_winter_10304$lowlevel
x <- hydro_winter_10304$groundwaterdepth
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_10304_groundwaterdepth <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 10304", x = "groundwaterdepth", y = "LowLevel")
event_winter_10304_groundwaterdepth0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "groundwaterdepth", y = "Low Level")
event_winter_10304_groundwaterdepth1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "groundwaterdepth", y = "Low Level")
grid_event_winter_10304_groundwaterdepth <- grid.arrange(event_winter_10304_groundwaterdepth, event_winter_10304_groundwaterdepth0, event_winter_10304_groundwaterdepth1, ncol = 1)  


y <- hydro_winter_11502$lowlevel
x <- hydro_winter_11502$groundwaterdepth
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_11502_groundwaterdepth <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 11502", x = "groundwaterdepth", y = "LowLevel")
event_winter_11502_groundwaterdepth0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "groundwaterdepth", y = "Low Level")
event_winter_11502_groundwaterdepth1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "groundwaterdepth", y = "Low Level")
grid_event_winter_11502_groundwaterdepth <- grid.arrange(event_winter_11502_groundwaterdepth, event_winter_11502_groundwaterdepth0, event_winter_11502_groundwaterdepth1, ncol = 1)



y <- hydro_winter_20203$lowlevel
x <- hydro_winter_20203$groundwaterdepth
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_20203_groundwaterdepth <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 20203", x = "groundwaterdepth", y = "LowLevel")
event_winter_20203_groundwaterdepth0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "groundwaterdepth", y = "Low Level")
event_winter_20203_groundwaterdepth1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "groundwaterdepth", y = "Low Level")
grid_event_winter_20203_groundwaterdepth <- grid.arrange(event_winter_20203_groundwaterdepth, event_winter_20203_groundwaterdepth0, event_winter_20203_groundwaterdepth1, ncol = 1)

grid.arrange(grid_event_winter_10304_groundwaterdepth, grid_event_winter_11502_groundwaterdepth, grid_event_winter_20203_groundwaterdepth, ncol = 2)
grid.arrange(grid_event_summer_10304_groundwaterdepth, grid_event_summer_11502_groundwaterdepth, grid_event_summer_20203_groundwaterdepth, grid_event_winter_10304_groundwaterdepth, grid_event_winter_11502_groundwaterdepth, grid_event_winter_20203_groundwaterdepth, ncol = 3)


```

##soilwater
``` {r}
# summer

y <- hydro_summer_10304$lowlevel
x <- hydro_summer_10304$soilwater
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_10304_soilwater <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 10304", x = "soilwater", y = "LowLevel")
event_summer_10304_soilwater0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "soilwater", y = "Low Level")
event_summer_10304_soilwater1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "soilwater", y = "Low Level")
grid_event_summer_10304_soilwater <- grid.arrange(event_summer_10304_soilwater, event_summer_10304_soilwater0, event_summer_10304_soilwater1, ncol = 1)


y <- hydro_summer_11502$lowlevel
x <- hydro_summer_11502$soilwater
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_11502_soilwater <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 11502", x = "soilwater", y = "LowLevel")
event_summer_11502_soilwater0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "soilwater", y = "Low Level")
event_summer_11502_soilwater1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "soilwater", y = "Low Level")
grid_event_summer_11502_soilwater <- grid.arrange(event_summer_11502_soilwater, event_summer_11502_soilwater0, event_summer_11502_soilwater1, ncol = 1)


y <- hydro_summer_20203$lowlevel
x <- hydro_summer_20203$soilwater
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_20203_soilwater <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 20203", x = "soilwater", y = "LowLevel")
event_summer_20203_soilwater0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "soilwater", y = "Low Level")
event_summer_20203_soilwater1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "soilwater", y = "Low Level")
grid_event_summer_20203_soilwater <- grid.arrange(event_summer_20203_soilwater, event_summer_20203_soilwater0, event_summer_20203_soilwater1, ncol = 1)

grid.arrange(grid_event_summer_10304_soilwater, grid_event_summer_11502_soilwater, grid_event_summer_20203_soilwater, ncol = 2)

# winter
y <- hydro_winter_10304$lowlevel
x <- hydro_winter_10304$soilwater
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_10304_soilwater <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 10304", x = "soilwater", y = "LowLevel")
event_winter_10304_soilwater0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "soilwater", y = "Low Level")
event_winter_10304_soilwater1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "soilwater", y = "Low Level")
grid_event_winter_10304_soilwater <- grid.arrange(event_winter_10304_soilwater, event_winter_10304_soilwater0, event_winter_10304_soilwater1, ncol = 1)       

y <- hydro_winter_11502$lowlevel
x <- hydro_winter_11502$soilwater
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_11502_soilwater <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 11502", x = "soilwater", y = "LowLevel")
event_winter_11502_soilwater0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "soilwater", y = "Low Level")
event_winter_11502_soilwater1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "soilwater", y = "Low Level")
grid_event_winter_11502_soilwater <- grid.arrange(event_winter_11502_soilwater, event_winter_11502_soilwater0, event_winter_11502_soilwater1, ncol = 1)


y <- hydro_winter_20203$lowlevel
x <- hydro_winter_20203$soilwater
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_20203_soilwater <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 20203", x = "soilwater", y = "LowLevel")
event_winter_20203_soilwater0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "soilwater", y = "Low Level")
event_winter_20203_soilwater1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "soilwater", y = "Low Level")
grid_event_winter_20203_soilwater <- grid.arrange(event_winter_20203_soilwater, event_winter_20203_soilwater0, event_winter_20203_soilwater1, ncol = 1)

grid.arrange(grid_event_summer_10304_soilwater, grid_event_summer_11502_soilwater, grid_event_summer_20203_soilwater, ncol = 2)
grid.arrange(grid_event_summer_10304_soilwater, grid_event_summer_11502_soilwater, grid_event_summer_20203_soilwater, grid_event_summer_10304_soilwater, grid_event_summer_11502_soilwater, grid_event_summer_20203_soilwater, ncol = 3)

```

##Snow
``` {r}

# summer

y <- hydro_summer_10304$lowlevel
x <- hydro_summer_10304$snowstorage
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_10304_snowstorage <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 10304", x = "snowstorage", y = "LowLevel")
event_summer_10304_snowstorage0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "snowstorage", y = "Low Level")
event_summer_10304_snowstorage1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "snowstorage", y = "Low Level")
grid_event_summer_10304_snowstorage <- grid.arrange(event_summer_10304_snowstorage, event_summer_10304_snowstorage0, event_summer_10304_snowstorage1, ncol = 1)


y <- hydro_summer_11502$lowlevel
x <- hydro_summer_11502$snowstorage
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_11502_snowstorage <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 11502", x = "snowstorage", y = "LowLevel")
event_summer_11502_snowstorage0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "snowstorage", y = "Low Level")
event_summer_11502_snowstorage1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "snowstorage", y = "Low Level")
grid_event_summer_11502_snowstorage <- grid.arrange(event_summer_11502_snowstorage, event_summer_11502_snowstorage0, event_summer_11502_snowstorage1, ncol = 1)


y <- hydro_summer_20203$lowlevel
x <- hydro_summer_20203$snowstorage
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_summer_20203_snowstorage <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Summer 20203", x = "snowstorage", y = "LowLevel")
event_summer_20203_snowstorage0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "snowstorage", y = "Low Level")
event_summer_20203_snowstorage1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "snowstorage", y = "Low Level")
grid_event_summer_20203_snowstorage <- grid.arrange(event_summer_20203_snowstorage, event_summer_20203_snowstorage0, event_summer_20203_snowstorage1, ncol = 1)

grid.arrange(grid_event_summer_10304_snowstorage, grid_event_summer_11502_snowstorage, grid_event_summer_20203_snowstorage, ncol = 2)

# winter
y <- hydro_winter_10304$lowlevel
x <- hydro_winter_10304$snowstorage
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_10304_snowstorage <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 10304", x = "snowstorage", y = "LowLevel")
event_winter_10304_snowstorage0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "snowstorage", y = "Low Level")
event_winter_10304_snowstorage1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "snowstorage", y = "Low Level")
grid_event_winter_10304_snowstorage <- grid.arrange(event_winter_10304_snowstorage, event_winter_10304_snowstorage0, event_winter_10304_snowstorage1, ncol = 1)       

y <- hydro_winter_11502$lowlevel
x <- hydro_winter_11502$snowstorage
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_11502_snowstorage <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 11502", x = "snowstorage", y = "LowLevel")
event_winter_11502_snowstorage0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "snowstorage", y = "Low Level")
event_winter_11502_snowstorage1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "snowstorage", y = "Low Level")
grid_event_winter_11502_snowstorage <- grid.arrange(event_winter_11502_snowstorage, event_winter_11502_snowstorage0, event_winter_11502_snowstorage1, ncol = 1)


y <- hydro_winter_20203$lowlevel
x <- hydro_winter_20203$snowstorage
cor(x, y, method = "pearson")
glm(y~x, data = data.frame(x, y), family = binomial())
event_winter_20203_snowstorage <- ggplot(data = data.frame(x, y), aes(x = x , y = y)) +
                            geom_point() +
                            geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
                            labs(title = "Winter 20203", x = "snowstorage", y = "LowLevel")
event_winter_20203_snowstorage0 <- ggplot(data.frame(y, x) %>% filter(y == 0), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 0", x = "snowstorage", y = "Low Level")
event_winter_20203_snowstorage1 <- ggplot(data.frame(y, x) %>% filter(y == 1), aes(x = x, y = y)) +
                            geom_boxplot() +
                            labs(title = "LowLevel = 1", x = "snowstorage", y = "Low Level")
grid_event_winter_20203_snowstorage <- grid.arrange(event_winter_20203_snowstorage, event_winter_20203_snowstorage0, event_winter_20203_snowstorage1, ncol = 1)

grid.arrange(grid_event_summer_10304_snowstorage, grid_event_summer_11502_snowstorage, grid_event_summer_20203_snowstorage, ncol = 2)
grid.arrange(grid_event_summer_10304_snowstorage, grid_event_summer_11502_snowstorage, grid_event_summer_20203_snowstorage, grid_event_summer_10304_snowstorage, grid_event_summer_11502_snowstorage, grid_event_summer_20203_snowstorage, ncol = 3)

```

# Forst plot
``` {r}
## Sommer

varnames <- colnames(hydro_summer_10304)
varnames[15] <- "Lufttemperatur"
varnames[18] <- "Niederschlag"
varnames[16] <- "KurzwelligeStrahlung"
varnames[19] <- "RelativeLuftfeuchte"
varnames[17] <- "Grundwasserstand"
varnames[37] <- "relOberflächennaheBodenfeuchte"
varnames[20] <- "Schneespeicher"
varnames[26] <- "Niedriwasserevent"
varnames[22] <- "Wasserleitfähigkeit"
## 10304
hydro_summer_10304_named <- hydro_summer_10304
colnames(hydro_summer_10304_named) <- varnames
sommer10304GLM <- glm(Niedriwasserevent ~ Lufttemperatur + Niederschlag + KurzwelligeStrahlung + RelativeLuftfeuchte + Grundwasserstand + relOberflächennaheBodenfeuchte + Schneespeicher + Wasserleitfähigkeit, family = binomial(link='logit'), data = hydro_summer_10304_named)
#11502
hydro_summer_11502_named <- hydro_summer_11502
colnames(hydro_summer_11502_named) <- varnames
sommer11502GLM <- glm(Niedriwasserevent ~ Lufttemperatur + Niederschlag + KurzwelligeStrahlung + RelativeLuftfeuchte + Grundwasserstand + relOberflächennaheBodenfeuchte + Schneespeicher + Wasserleitfähigkeit, family = binomial(link='logit'), data = hydro_summer_11502_named)
#20203
hydro_summer_20203_named <- hydro_summer_20203
colnames(hydro_summer_20203_named) <- varnames
sommer20203GLM <- glm(Niedriwasserevent ~ Lufttemperatur + Niederschlag + KurzwelligeStrahlung + RelativeLuftfeuchte + Grundwasserstand + relOberflächennaheBodenfeuchte + Schneespeicher + Wasserleitfähigkeit, family = binomial(link='logit'), data = hydro_summer_20203_named)

##Winter
##10304
hydro_summer_10304_named <- hydro_summer_10304
colnames(hydro_summer_10304_named) <- varnames
winter10304GLM <- glm(Niedriwasserevent ~ Lufttemperatur + Niederschlag + KurzwelligeStrahlung + RelativeLuftfeuchte + Grundwasserstand + relOberflächennaheBodenfeuchte + Schneespeicher + Wasserleitfähigkeit, family = binomial(link='logit'), data = hydro_summer_10304_named)
#11502
hydro_winter_11502_named <- hydro_winter_11502
colnames(hydro_winter_11502_named) <- varnames
winter11502GLM <- glm(Niedriwasserevent ~ Lufttemperatur + Niederschlag + KurzwelligeStrahlung + RelativeLuftfeuchte + Grundwasserstand + relOberflächennaheBodenfeuchte + Schneespeicher + Wasserleitfähigkeit, family = binomial(link='logit'), data = hydro_winter_11502_named)
#20203
hydro_summer_20203_named <- hydro_summer_20203
colnames(hydro_summer_20203_named) <- varnames
winter20203GLM <- glm(Niedriwasserevent ~ Lufttemperatur + Niederschlag + KurzwelligeStrahlung + RelativeLuftfeuchte + Grundwasserstand + relOberflächennaheBodenfeuchte + Schneespeicher + Wasserleitfähigkeit, family = binomial(link='logit'), data = hydro_summer_20203_named)

all.models <- list()
all.models[[1]] <- sommer10304GLM
all.models[[2]] <- sommer11502GLM
all.models[[3]] <- sommer20203GLM
all.models[[4]] <- winter10304GLM
all.models[[5]] <- winter11502GLM
all.models[[6]] <- winter20203GLM
plot_models(all.models)
p <- last_plot() +
  scale_color_manual(values = c("yellow", "red", "blue","pink", "green", "purple" ), 
                     name = "Gewässer/Halbjahr", 
                     labels = c("Winter Fraenkische Saale Salz",  "Winter Iller Kempten",  "Winter Isar Mittenwald","Sommer Fraenkische Saale Salz", "Sommer Iller Kempten", "Sommer Isar Mittenwald")) +
  theme(legend.title = element_text(size = 12, face = "bold"))+
  ylab("Odds Ratio")

print(p)
```

```










