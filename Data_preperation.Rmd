---
title: "Data Preperation"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
# Import packages
library(tidyverse)
```

## Data import

```{r Data import}
pegel_eigen <- read_csv2(file = "data/Geo-Daten_Uebersicht/Eigenschaften_Pegel.csv")
pegel_eigen <- read.csv2("data/Geo-Daten_Uebersicht/Eigenschaften_Pegel.csv")
hydro_summer <- read.table("data/Zielvariablen/hydro_summer.txt")
hydro_winter <- read.table("data/Zielvariablen/hydro_winter.txt")

pegel_ids <- c("20203", "11502", "10304")
names(pegel_ids) <- c("PEG-Fraenkische-Saale-Salz", "PEG-Iller-Kempten", "PEG-Isar-Mittenwald")
pegel_ids_list <- list("20203", "11502", "10304")
names(pegel_ids_list) <- c("Fraenkische Saale Salz", "Iller Kempten", "Isar Mittenwald")
```

## Overview

```{r Overview, echo=FALSE}
hydro_summer %>% count(member, sort = TRUE)
hydro_winter %>% count(member, sort = TRUE)
head(pegel_eigen)
head(hydro_summer)
head(hydro_winter)
unique(hydro_summer$slope)
```

## Data Manipulation

```{r}
# Remove index row for pegel_eigen
pegel_eigen  <- pegel_eigen[-1]

# Filter for our 3 waterlevel
pegel_prop <- pegel_eigen %>% filter(ID %in% pegel_ids)

# Change name_waterlevel
hydro_summer$name_waterlevel <- sub('.', '', hydro_summer$name_waterlevel)
hydro_winter$name_waterlevel <- sub('.', '', hydro_winter$name_waterlevel)

hydro_summer$name_waterlevel <- as.factor(hydro_summer$name_waterlevel)
hydro_winter$name_waterlevel <- as.factor(hydro_winter$name_waterlevel)

hydro_summer$waterlevel <- hydro_summer$name_waterlevel
levels(hydro_summer$waterlevel) <- pegel_ids_list
hydro_winter$waterlevel <- hydro_winter$name_waterlevel
levels(hydro_winter$waterlevel) <- pegel_ids_list

# Adjust data types
hydro_summer$date <- as.Date(hydro_summer$date)
hydro_winter$date <- as.Date(hydro_winter$date)

hydro_summer$member <- as.factor(hydro_summer$member)
hydro_winter$member <- as.factor(hydro_winter$member)

hydro_summer$river <- as.factor(hydro_summer$river)
hydro_winter$river <- as.factor(hydro_winter$river)

hydro_summer$landuse <- as.factor(hydro_summer$landuse)
hydro_winter$landuse <- as.factor(hydro_winter$landuse)

hydro_summer$exposition <- as.factor(hydro_summer$exposition)
hydro_winter$exposition <- as.factor(hydro_winter$exposition)

hydro_summer$lowlevel_1d <- as.factor(hydro_summer$lowlevel_1d)
levels(hydro_summer$lowlevel_1d) <- c(FALSE, TRUE)
hydro_winter$lowlevel_1d <- as.factor(hydro_winter$lowlevel_1d)
levels(hydro_winter$lowlevel_1d) <- c(FALSE, TRUE)
hydro_summer$lowlevel <- as.factor(hydro_summer$lowlevel)
levels(hydro_summer$lowlevel) <- c(FALSE, TRUE)
hydro_winter$lowlevel <- as.factor(hydro_winter$lowlevel)
levels(hydro_winter$lowlevel) <- c(FALSE, TRUE)

hydro_summer$hydro_year <- as.factor(hydro_summer$hydro_year)
hydro_winter$hydro_year <- as.factor(hydro_winter$hydro_year)


# Create subsets for hydrological half-year for each waterlevel
hydro_summer_20203 <- hydro_summer %>% filter(name_waterlevel == "20203")
hydro_summer_11502 <- hydro_summer %>% filter(name_waterlevel == "11502")
hydro_summer_10304 <- hydro_summer %>% filter(name_waterlevel == "10304")
hydro_winter_20203 <- hydro_winter %>% filter(name_waterlevel == "20203")
hydro_winter_11502 <- hydro_winter %>% filter(name_waterlevel == "11502")
hydro_winter_10304 <- hydro_winter %>% filter(name_waterlevel == "10304")

# Create hydro total
hydro_total <- rbind(hydro_summer, hydro_winter)
```

## Save data

```{r}
# Save pegel_prop
saveRDS(object = pegel_prop, file = "data/pegel_prop.RDS")

# Save subsets for hydrological half-year for each waterlevel
saveRDS(object = hydro_summer_20203, file = "data/hydro_summer_20203.RDS")
saveRDS(object = hydro_summer_11502, file = "data/hydro_summer_11502.RDS")
saveRDS(object = hydro_summer_10304, file = "data/hydro_summer_10304.RDS")
saveRDS(object = hydro_winter_20203, file = "data/hydro_winter_20203.RDS")
saveRDS(object = hydro_winter_11502, file = "data/hydro_winter_11502.RDS")
saveRDS(object = hydro_winter_10304, file = "data/hydro_winter_10304.RDS")

# Save hydrological half years
saveRDS(object = hydro_summer, file = "data/hydro_summer.RDS")
saveRDS(object = hydro_winter, file = "data/hydro_winter.RDS")

# Save hydro total
saveRDS(object = hydro_total, file = "data/hydro_total.RDS")
```

